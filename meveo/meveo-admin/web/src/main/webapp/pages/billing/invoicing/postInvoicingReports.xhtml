<!DOCTYPE composition PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<ui:composition xmlns="http://www.w3.org/1999/xhtml"
	xmlns:s="http://jboss.com/products/seam/taglib"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:rich="http://richfaces.org/rich"
	xmlns:a="http://richfaces.org/a4j" xmlns:hftl="http://hftl.org"
	xmlns:hf="http://java.sun.com/jsf/composite/tags"
	template="/layout/template.xhtml"
	xmlns:e="http://jboss.com/products/seam/excel">

	<ui:define name="navigation">
		<ui:include src="/layout/navigation.xhtml" />
	</ui:define>

	<ui:define name="body">

		<hf:formPanel formId="form3" edit="false"
			label="#{messages['postInvoicingReport.title']}"
			backingBean="#{billingRunBean}" entity="#{billingRun}"
			showFormButtons="false">

			<custom:panelGroup columns="1">
				<hf:formEntityField
					label="#{messages['postInvoicingReport.globalAmountHT']}"
					field="postInvoicingReports" childField="globalAmount"
					popup="false" />
				<hf:formEntityField
					label="#{messages['postInvoicingReport.invoicesNumber']}"
					field="postInvoicingReports" childField="invoicesNumber"
					popup="false" />
			</custom:panelGroup>

			<custom:panelGroup columns="2">
				<hf:formEntityField
					label="#{messages['postInvoicingReport.positiveInvoicesNumber']}"
					field="postInvoicingReports" childField="positiveInvoicesNumber"
					popup="false" />
				<hf:formEntityField
					label="#{messages['postInvoicingReport.positiveInvoicesAmountHT']}"
					field="postInvoicingReports" childField="positiveInvoicesAmountHT"
					popup="false" />
			</custom:panelGroup>

			<custom:panelGroup columns="2">
				<hf:formEntityField
					label="#{messages['postInvoicingReport.positiveInvoicesAmount']}"
					field="postInvoicingReports" childField="positiveInvoicesAmount"
					popup="false" />
				<hf:formEntityField
					label="#{messages['postInvoicingReport.positiveInvoicesTaxAmount']}"
					field="postInvoicingReports" childField="positiveInvoicesTaxAmount"
					popup="false" />
			</custom:panelGroup>

			<custom:panelGroup columns="2">
				<hf:formEntityField
					label="#{messages['postInvoicingReport.negativeInvoicesAmountHT']}"
					field="postInvoicingReports" childField="negativeInvoicesAmountHT"
					popup="false" />
				<hf:formEntityField
					label="#{messages['postInvoicingReport.negativeInvoicesTaxAmount']}"
					field="postInvoicingReports" childField="negativeInvoicesTaxAmount"
					popup="false" />
			</custom:panelGroup>

			<custom:panelGroup columns="1">
				<hf:formEntityField id="positiveInvoicesAmount"
					label="#{messages['postInvoicingReport.negativeInvoicesAmount']}"
					field="postInvoicingReports" childField="negativeInvoicesAmount"
					popup="false" />
			</custom:panelGroup>

			<custom:panelGroup columns="2">
				<hf:formEntityField id="emptyInvoicesNumber"
					label="#{messages['postInvoicingReport.emptyInvoicesNumber']}"
					field="postInvoicingReports" childField="emptyInvoicesNumber"
					popup="false" />
				<hf:formEntityField id="electronicInvoicesNumber"
					label="#{messages['postInvoicingReport.electronicInvoicesNumber']}"
					field="postInvoicingReports" childField="electronicInvoicesNumber"
					popup="false" />
			</custom:panelGroup>


			<br />
			<br />
			<b>#{messages['postInvoicingReport.invoicesNumberPerPaymentMode']}</b>
			<custom:panelGroup columns="1">
				<hf:formEntityField label="#{messages['paymentMethod.check']}"
					field="postInvoicingReports" childField="checkInvoicesNumber"
					popup="false" />
			</custom:panelGroup>
			<custom:panelGroup columns="1">
				<hf:formEntityField
					label="#{messages['paymentMethod.directDebit']}"
					field="postInvoicingReports" childField="directDebitInvoicesNumber"
					popup="false" />
			</custom:panelGroup>
			<custom:panelGroup columns="1">
				<hf:formEntityField label="#{messages['paymentMethod.tip']}"
					field="postInvoicingReports" childField="tipInvoicesNumber"
					popup="false" />
			</custom:panelGroup>
			<custom:panelGroup columns="1">
				<hf:formEntityField
					label="#{messages['paymentMethod.wiretransfer']}"
					field="postInvoicingReports"
					childField="wiretransferInvoicesNumber" popup="false" />
			</custom:panelGroup>

			<b>#{messages['postInvoicingReport.amoutHtPerPaymentMode']}</b>
			<custom:panelGroup columns="1">
				<hf:formEntityField label="#{messages['paymentMethod.check']}"
					field="postInvoicingReports" childField="checkAmuontHT"
					popup="false" />
			</custom:panelGroup>
			<custom:panelGroup columns="1">
				<hf:formEntityField
					label="#{messages['paymentMethod.directDebit']}"
					field="postInvoicingReports" childField="directDebitAmuontHT"
					popup="false" />
			</custom:panelGroup>
			<custom:panelGroup columns="1">
				<hf:formEntityField label="#{messages['paymentMethod.tip']}"
					field="postInvoicingReports" childField="tipAmuontHT" popup="false" />
			</custom:panelGroup>
			<custom:panelGroup columns="1">
				<hf:formEntityField
					label="#{messages['paymentMethod.wiretransfer']}"
					field="postInvoicingReports" childField="wiretransferAmuontHT"
					popup="false" />
			</custom:panelGroup>

			<b>#{messages['postInvoicingReport.amoutTtcPerPaymentMode']}</b>

			<custom:panelGroup columns="1">
				<hf:formEntityField label="#{messages['paymentMethod.check']}"
					field="postInvoicingReports" childField="checkAmuont" popup="false" />
			</custom:panelGroup>
			<custom:panelGroup columns="1">
				<hf:formEntityField
					label="#{messages['paymentMethod.directDebit']}"
					field="postInvoicingReports" childField="directDebitAmuont"
					popup="false" />
			</custom:panelGroup>
			<custom:panelGroup columns="1">
				<hf:formEntityField label="#{messages['paymentMethod.tip']}"
					field="postInvoicingReports" childField="tipAmuont" popup="false" />
			</custom:panelGroup>
			<custom:panelGroup columns="1">
				<hf:formEntityField
					label="#{messages['paymentMethod.wiretransfer']}"
					field="postInvoicingReports" childField="wiretransferAmuont"
					popup="false" />
			</custom:panelGroup>

		</hf:formPanel>

		<br />
		<h:outputText value="#{messages['postInvoicingReport.billableBA']}"
			style="font-weight: bold;font-size=14;" />
		<hftl:dataList dataModel="#{billingRunBean.invoicesModel}"
			backingBean="#{billingRunBean}">
			<rich:column sortable="true" width="10px" label="Selected">
				<f:facet name="header">
					<s:div style="text-align:left">
						<h:selectBooleanCheckbox id="checkUncheckAll"
							valueChangeListener="#{backingBean.checkUncheckAll}"
							value="#{backingBean.getItemSelector().modeAllSelected}">
							<a:support event="onclick" reRender="datatable" ajaxSingle="true"
								limitToList="true" bypassUpdates="true" />
						</h:selectBooleanCheckbox>
					</s:div>
				</f:facet>
				<h:selectBooleanCheckbox
					valueChangeListener="#{backingBean.selectChanged}"
					value="#{billingRunBean.getItemSelector().isSelected(entity)}">
					<a:support event="onclick" ajaxSingle="true" limitToList="true"
						bypassUpdates="true" reRender="datatable" />
				</h:selectBooleanCheckbox>
			</rich:column>

			<hftl:column label="#{messages['businessEntity.code']}"
				field="billingAccount" childField="code" />
			<rich:column width="100">
				<f:facet name="header">
					<h:outputText value="#{messages['name.title']}" />
				</f:facet>
				<e:cell>
					<h:outputText
						rendered="#{entity.billingAccount.name.title != null}"
						value="#{messages[stringUtil.merge('Title.',entity.billingAccount.name.title.code)]}" />
				</e:cell>
			</rich:column>

			<hftl:column label="#{messages['billingAccount.name']}"
				field="billingAccount" childField="name" />
			<hftl:column label="#{messages['invoice.amountWithoutTax']}"
				field="amountWithoutTax" />
			<hftl:column label="#{messages['invoice.amountTax']}"
				field="amountTax" />
			<hftl:column label="#{messages['invoice.amountWithTax']}"
				field="amountWithTax" />

		</hftl:dataList>

		<h:form id="operationsForm2"
			rendered="#{billingRun.getInvoices().size()>0}">
			<h:commandButton action="#{billingRunBean.excludeBillingAccounts}"
				value="Exclure" />
		</h:form>

		<br />
		<br />
		<h:form id="operationsForm" rendered="#{!edit}">
			<h:commandButton action="#{billingRunBean.validateInvoicing()}"
				value="Valider" />
			<h:commandButton
				action="#{billingRunBean.rerateConfirmedInvoicing()}"
				value="Revaloriser" />
			<h:commandButton
				action="#{billingRunBean.cancelConfirmedInvoicing()}"
				value="Annuler le traitement"
				onclick="if(confirm('#{messages['commons.confirmCancelInvoiceProcess']}')){return true;}else{return false;}" />
		</h:form>
	</ui:define>
</ui:composition>
