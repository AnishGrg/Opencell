<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head profile="http://selenium-ide.openqa.org/profiles/test-case">
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
<link rel="selenium.base" href="http://i.meveo.info/" />
<title>variables</title>
</head>
<body>
<table cellpadding="1" cellspacing="1" border="1">
<thead>
<tr><td rowspan="1" colspan="3">variables</td></tr>
</thead><tbody>
<tr>
	<td>store</td>
	<td>//*[contains(@id, 'description_txt')]</td>
	<td>descriptionText</td>
</tr>
<tr>
	<td>store</td>
	<td>//*[contains(@id, 'sourceTypeEnum_enum_label')]</td>
	<td>ChooseType</td>
</tr>
<tr>
	<td>store</td>
	<td>//*[contains(@id, 'exportLinkDialog')]</td>
	<td>IconExport</td>
</tr>
<tr>
	<td>store</td>
	<td>xpath=/html/body/div[1]/div[2]/div[2]/form/div/div[2]/div/div/div[2]/div[1]/div/div/div[3]/span</td>
	<td>Provider</td>
</tr>
<tr>
	<td>store</td>
	<td>id=parameterForm:param_zip</td>
	<td>ZipExportFile</td>
</tr>
<tr>
	<td>store</td>
	<td>xpath=/html/body/div[1]/div[2]/div[2]/form/div/div[2]/div[2]/div[3]/div/div/div[3]/span</td>
	<td>ExportToRemoteMeveoInstance</td>
</tr>
<tr>
	<td>store</td>
	<td>document.parameterForm.elements[4]</td>
	<td>ExportButton</td>
</tr>
<tr>
	<td>store</td>
	<td>document.parameterForm.elements[5]</td>
	<td>CancelButton</td>
</tr>
<tr>
	<td>store</td>
	<td>//tbody[@id='datatable_results_data']/tr/td/div/div[2]/span</td>
	<td>CheckOne</td>
</tr>
<!--variables definition-->
<tr>
	<td>store</td>
	<td>true</td>
	<td>ScriptInstanceBool</td>
</tr>
<tr>
	<td>store</td>
	<td>package org.meveo.service.script;&nbsp;&nbsp;import java.util.List; import java.util.Map;&nbsp;&nbsp;import org.meveo.admin.exception.BusinessException; import org.meveo.cache.CdrEdrProcessingCacheContainerProvider; import org.meveo.model.crm.Provider; import org.meveo.model.mediation.Access; import org.meveo.service.script.Script; import org.slf4j.Logger; import org.slf4j.LoggerFactory;&nbsp;&nbsp;public class Mediation_RoutingSub extends Script {&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;private static final Logger log = LoggerFactory.getLogger(Mediation_RoutingSub.class);&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CdrEdrProcessingCacheContainerProvider cdrEdrProcessingCacheContainerProvider = (CdrEdrProcessingCacheContainerProvider) getServiceInterface(&quot;CdrEdrProcessingCacheContainerProvider&quot;);&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;public void execute(Map&lt;String, Object&gt; initContext,Provider provider)throws BusinessException {&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;log.debug(&quot;Execute...&quot;);&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;String accessUserId = (String) initContext.get(&quot;accessUserId&quot;);&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;List&lt;Access&gt; accesses = cdrEdrProcessingCacheContainerProvider.getAccessesByAccessUserId(provider.getId(), accessUserId);&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;initContext.put(&quot;accesses&quot;, accesses);&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;log.info(&quot;Execute accesses size:&quot;+((accesses == null)?&quot;null&quot;:accesses.size()));&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;} }</td>
	<td>ScriptInstanceValue1</td>
</tr>
<tr>
	<td>store</td>
	<td>package org.meveo.service.script; import java.util.Map; import org.meveo.admin.exception.BusinessException; import org.meveo.model.admin.User; import org.meveo.model.billing.BillingRun; import org.meveo.model.billing.Invoice; import org.meveo.model.crm.Provider; import org.slf4j.Logger; import org.slf4j.LoggerFactory; public class billingRun extends Script { private static final Logger log = LoggerFactory.getLogger(BillingRun.class); String recordSeparator=&quot;,&quot;; String lineSeparator=&quot;&quot;; public void execute(Map&lt;String,Object&gt; context,Provider provider,User user) throws BusinessException{ BillingRun br = (BillingRun) context.get(&quot;billingRun&quot;);&nbsp;&nbsp;if(br!=null){ String emailTitle =&quot;BillingRun[&quot;+br.getId()+&quot;] &quot;; String emailBody=&quot;No invoice&quot;; if(br.getInvoiceNumber()!=null &amp;&amp; br.getInvoiceNumber()&gt;0){ emailTitle+=br.getInvoiceNumber()+&quot; invoice&quot;+(br.getInvoiceNumber()&gt;1?&quot;s&quot;:&quot;&quot;); emailBody=&quot;BA code&quot;+recordSeparator +&quot; Invoice no&quot;+recordSeparator +&quot; Invoice amount without tax&quot;+recordSeparator +&quot; Invoice amount with tax&quot;+lineSeparator; for(Invoice invoice:br.getInvoices()){ emailBody+=invoice.getBillingAccount().getCode()+recordSeparator +invoice.getInvoiceNumber()+recordSeparator +invoice.getAmountWithoutTax()+recordSeparator +invoice.getAmountWithTax()+lineSeparator; } } context.put(&quot;emailTitle&quot;,emailTitle); context.put(&quot;emailBody&quot;,emailBody); } }}</td>
	<td>ScriptInstanceValue2</td>
</tr>
<tr>
	<td>store</td>
	<td>true</td>
	<td>DescriptionBool</td>
</tr>
<tr>
	<td>store</td>
	<td>Mediation Script</td>
	<td>DescriptionValue1</td>
</tr>
<tr>
	<td>store</td>
	<td>BR Script</td>
	<td>DescriptionValue2</td>
</tr>
<tr>
	<td>store</td>
	<td>true</td>
	<td>TypeBool</td>
</tr>
<tr>
	<td>store</td>
	<td>JAVA</td>
	<td>TypeValue</td>
</tr>
<tr>
	<td>store</td>
	<td>true</td>
	<td>ZipExportFileBool</td>
</tr>
<tr>
	<td>store</td>
	<td>org.meveo.service.script.billingRun</td>
	<td>Code</td>
</tr>
</tbody></table>
</body>
</html>
