<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<databaseChangeLog xmlns="http://www.liquibase.org/xml/ns/dbchangelog"
	xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
	xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-3.2.xsd">

	<changeSet id="EdwardLegaspi" author="#655_20150522">
		<createTable tableName="ar_credit_category">
			<column name="id" type="BIGINT">
				<constraints nullable="false" />
			</column>
			<column name="version" type="INT4" />
			<column name="disabled" type="BOOL">
				<constraints nullable="false" />
			</column>
			<column name="created" type="TIMESTAMP WITHOUT TIME ZONE">
				<constraints nullable="false" />
			</column>
			<column name="updated" type="TIMESTAMP WITHOUT TIME ZONE" />
			<column name="code" type="VARCHAR(60)">
				<constraints nullable="false" />
			</column>
			<column name="description" type="VARCHAR(100)" />
			<column name="provider_id" type="BIGINT" />
			<column name="creator_id" type="BIGINT" />
			<column name="updater_id" type="BIGINT" />
		</createTable>
		<addUniqueConstraint columnNames="id"
			tableName="ar_credit_category" />
		<addForeignKeyConstraint constraintName="fk_adm_user_creator_ar_credit_category"
			referencedTableName="adm_user" baseColumnNames="creator_id"
			baseTableName="ar_credit_category" referencedColumnNames="id" />
		<addForeignKeyConstraint constraintName="fk_adm_user_updater_ar_credit_category"
			referencedTableName="adm_user" baseColumnNames="updater_id"
			baseTableName="ar_credit_category" referencedColumnNames="id" />

		<createSequence sequenceName="ar_credit_category_seq"
			startValue="6" />

		<dropColumn tableName="ar_customer_account" columnName="credit_category" />
		<addColumn tableName="ar_customer_account">
			<column name="credit_category_id" type="BIGINT" />
		</addColumn>
		<addForeignKeyConstraint constraintName="fk_ar_credit_category_ar_customer_account"
			referencedTableName="ar_credit_category" baseColumnNames="credit_category_id"
			baseTableName="ar_customer_account" referencedColumnNames="id" />

		<dropColumn tableName="ar_dunning_plan" columnName="credit_category" />
		<addColumn tableName="ar_dunning_plan">
			<column name="credit_category_id" type="BIGINT" />
		</addColumn>
		<addForeignKeyConstraint constraintName="fk_ar_credit_category_ar_dunning_plan"
			referencedTableName="ar_credit_category" baseColumnNames="credit_category_id"
			baseTableName="ar_dunning_plan" referencedColumnNames="id" />
		<addUniqueConstraint
			columnNames="credit_category_id, payment_method, provider_id, code"
			constraintName="uk_qn6vfgeg5g2y4pb9y6qb8ogjo" deferrable="false"
			disabled="false" initiallyDeferred="false" tableName="ar_dunning_plan" />
	</changeSet>

</databaseChangeLog>
