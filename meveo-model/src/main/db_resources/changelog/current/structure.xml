<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<databaseChangeLog xmlns="http://www.liquibase.org/xml/ns/dbchangelog"
	xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
	xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-3.2.xsd">

	<changeSet author="EdwardLegaspi" id="#1087_20150922">
		<createTable tableName="meveo_filter_parameter">
			<column name="id" type="BIGINT">
				<constraints nullable="false" />
			</column>
			<column name="version" type="INT4" />
			<column name="disabled" type="BOOL">
				<constraints nullable="false" />
			</column>
			<column name="created" type="TIMESTAMP WITHOUT TIME ZONE">
				<constraints nullable="false" />
			</column>
			<column name="updated" type="TIMESTAMP WITHOUT TIME ZONE" />
			<column name="provider_id" type="BIGINT" />
			<column name="creator_id" type="BIGINT" />
			<column name="updater_id" type="BIGINT" />
			<column name="code" type="VARCHAR(60)">
				<constraints nullable="false" />
			</column>
			<column name="description" type="VARCHAR(100)" />
			<column name="default_value" type="VARCHAR(50)" />
			<column name="value_required" type="BOOL" />
			<column name="field_type" type="VARCHAR(255)" />
			<column name="entity_clazz" type="VARCHAR(255)" />
			<column name="filter_id" type="BIGINT" />
		</createTable>

		<addPrimaryKey columnNames="id" constraintName="meveo_filter_parameter_pkey"
			tableName="meveo_filter_parameter" />

		<addForeignKeyConstraint baseColumnNames="provider_id"
			baseTableName="meveo_filter_parameter" constraintName="fk_meveo_filter_parameter_crm_provider"
			deferrable="false" initiallyDeferred="false" onDelete="NO ACTION"
			onUpdate="NO ACTION" referencedColumnNames="id" referencedTableName="crm_provider" />
		
		<addForeignKeyConstraint baseColumnNames="creator_id"
			baseTableName="meveo_filter_parameter" constraintName="fk_creator_meveo_filter_parameter_adm_user"
			deferrable="false" initiallyDeferred="false" onDelete="NO ACTION"
			onUpdate="NO ACTION" referencedColumnNames="id" referencedTableName="adm_user" />
		
		<addForeignKeyConstraint baseColumnNames="updater_id"
			baseTableName="meveo_filter_parameter" constraintName="fk_updater_meveo_filter_parameter_adm_user"
			deferrable="false" initiallyDeferred="false" onDelete="NO ACTION"
			onUpdate="NO ACTION" referencedColumnNames="id" referencedTableName="adm_user" />
		
		<addForeignKeyConstraint baseColumnNames="filter_id"
			baseTableName="meveo_filter_parameter" constraintName="fk_meveo_filter_parameter_meveo_filter"
			deferrable="false" initiallyDeferred="false" onDelete="CASCADE"
			onUpdate="CASCADE" referencedColumnNames="id" referencedTableName="meveo_filter" />

		<createTable tableName="meveo_filter_parameter_list_val">
			<column name="filterparameter_id" type="BIGINT">
				<constraints nullable="false" />
			</column>
			<column name="listvalues" type="VARCHAR(255)" />
			<column name="listvalues_key" type="VARCHAR(255)">
				<constraints nullable="false" />
			</column>
		</createTable>

		<createSequence sequenceName="meveo_filter_parameter_seq" />
	</changeSet>

	<changeSet author="anasseh" id="20150928_text">
     	<modifyDataType columnName="string_value" newDataType="text"   tableName="CRM_CUSTOM_FIELD_INST"/>
     </changeSet>
    
    <changeSet author="AndriusKarpavicius" id="#1094_20150929">
		<addColumn tableName="CRM_CUSTOM_FIELD_INST">
			<column name="seller_id" type="BIGINT" />
		</addColumn>    
    
    	<addForeignKeyConstraint constraintName="fk_seller_id_crm_custom_field_inst"
			referencedTableName="CRM_SELLER" baseColumnNames="seller_id"
			baseTableName="CRM_CUSTOM_FIELD_INST" referencedColumnNames="id" />
    </changeSet>

    <changeSet author="AndriusKarpavicius" id="#1123_20151006">
        <dropColumn tableName="MEVEO_JOB_INSTANCE" columnName="user_id"/>
    </changeSet>
	 <changeSet author="anasseh" id="#1117_20151005">
		    <addColumn tableName="BILLING_CYCLE">
	            <column name="INVOICING_THRESHOLD" type="numeric(23, 12)" />
	        </addColumn>	
	</changeSet>       
    <changeSet author="anasseh" id="20151009_1149">
        <modifyDataType columnName="SELECTED_BILLING_ACCOUNTS" newDataType="text"   tableName="BILLING_BILLING_RUN"/>
     </changeSet>
   	<changeSet author="anasseh" id="20151013_1165">
     	<modifyDataType columnName="MESSAGE" newDataType="text"   tableName="MEVEO_SCRIPT_INSTANCE_ERROR"/>
     </changeSet>      
     
	<changeSet author="EdwardLegaspi" id="#1110_20151002">
		<addColumn tableName="billing_invoice">
			<column name="code" type="VARCHAR(60)">
				<constraints nullable="true" />
			</column>
			<column name="description" type="VARCHAR(100)" />
		</addColumn>

		<sql>UPDATE billing_invoice SET code=concat('ocb_id_', id)</sql>

		<addNotNullConstraint columnDataType="VARCHAR(60)"
			columnName="code" tableName="billing_invoice" />
	</changeSet>  
	
    <changeSet id="#1150_20151013" author="Mbarek">
	<addColumn tableName="BILLING_INVOICE_CONFIGURATION">
	<column name="display_provider" type="BOOL" defaultValueBoolean="false"></column>
	</addColumn>
	</changeSet>   

	<changeSet author="EdwardLegaspi" id="#1147_20151009">
		<addColumn tableName="crm_provider">
			<column name="credit_note_prefix" type="VARCHAR(255)" />
			<column name="current_credit_note_nb" type="BIGINT" />
		</addColumn>
		<addColumn tableName="crm_seller">
			<column name="credit_note_prefix" type="VARCHAR(255)" />
			<column name="current_credit_note_nb" type="BIGINT" />
		</addColumn>
	</changeSet>

	<changeSet id="#1105_20151009" author="EdwardLegaspi">
		<dropForeignKeyConstraint baseTableName="billing_credit_note"
			constraintName="fk_billing_credit_note_recorded_invoice" />
		<dropColumn tableName="billing_credit_note" columnName="recorded_invoice_id" />

		<addColumn tableName="billing_credit_note">
			<column name="recorded_credit_note_id" type="BIGINT" />
		</addColumn>
		<addForeignKeyConstraint baseColumnNames="recorded_credit_note_id"
			baseTableName="billing_credit_note" constraintName="fk_billing_credit_note_recorded_credit_note"
			deferrable="false" initiallyDeferred="false" onDelete="NO ACTION"
			onUpdate="NO ACTION" referencedColumnNames="id" referencedTableName="ar_account_operation" />
	</changeSet>

	<changeSet id="#1138_20151009" author="EdwardLegaspi">
		<addColumn tableName="crm_provider">
			<column name="credit_note_sequence_size" type="INT4" />
		</addColumn>
		<addColumn tableName="crm_seller">
			<column name="credit_note_sequence_size" type="INT4" />
		</addColumn>

		<sql>UPDATE crm_provider SET credit_note_sequence_size=9;</sql>
	</changeSet>

	<changeSet author="anasseh" id="20151009_1149">
		<modifyDataType columnName="SELECTED_BILLING_ACCOUNTS"
			newDataType="text" tableName="BILLING_BILLING_RUN" />
	</changeSet>

	<changeSet author="anasseh" id="20151013_1165">
		<modifyDataType columnName="MESSAGE" newDataType="text"
			tableName="MEVEO_SCRIPT_INSTANCE_ERROR" />
	</changeSet>

	<changeSet id="#1150_20151013" author="Mbarek">
		<addColumn tableName="BILLING_INVOICE_CONFIGURATION">
			<column name="display_provider" type="BOOL"
				defaultValueBoolean="false"></column>
		</addColumn>
	</changeSet>

	<changeSet id="#REVERT_CREDIT_NOTE_20151014" author="EdwardLegaspi">
		<dropForeignKeyConstraint baseTableName="billing_credit_note"
			constraintName="fk_billing_credit_note_crm_provider" />
		<dropForeignKeyConstraint baseTableName="billing_credit_note"
			constraintName="fk_billing_credit_note_adm_user_creator" />
		<dropForeignKeyConstraint baseTableName="billing_credit_note"
			constraintName="fk_billing_credit_note_adm_user_updater" />
		<dropForeignKeyConstraint baseTableName="billing_credit_note"
			constraintName="fk_billing_credit_note_billing_account" />
		<dropForeignKeyConstraint baseTableName="billing_credit_note"
			constraintName="fk_billing_credit_note_invoice" />
		<dropForeignKeyConstraint baseTableName="billing_credit_note_tax_amt"
			constraintName="fk_billing_credit_note_tax_amt_credit_note" />
		<dropForeignKeyConstraint baseTableName="billing_credit_note_line"
			constraintName="fk_billing_credit_note_line_crm_provider" />
		<dropForeignKeyConstraint baseTableName="billing_credit_note_line"
			constraintName="fk_billing_credit_note_line_credit_note" />
		<dropForeignKeyConstraint baseTableName="billing_credit_note_line"
			constraintName="fk_billing_credit_note_line_invoice_sub_cat" />
		<dropForeignKeyConstraint baseTableName="billing_credit_note"
			constraintName="fk_billing_credit_note_recorded_credit_note" />

		<dropPrimaryKey tableName="billing_credit_note"
			constraintName="billing_credit_note_pkey" />
		<dropPrimaryKey tableName="billing_credit_note_line"
			constraintName="billing_credit_note_line_pkey" />
		<dropPrimaryKey tableName="billing_credit_note_tax_amt"
			constraintName="billing_credit_note_tax_amt_pkey" />

		<dropSequence sequenceName="billing_credit_note_seq" />
		<dropSequence sequenceName="billing_credit_note_line_seq" />

		<dropColumn tableName="crm_provider" columnName="credit_note_prefix" />
		<dropColumn tableName="crm_provider" columnName="current_credit_note_nb" />
		<dropColumn tableName="crm_provider" columnName="credit_note_sequence_size" />

		<dropColumn tableName="crm_seller" columnName="credit_note_prefix" />
		<dropColumn tableName="crm_seller" columnName="current_credit_note_nb" />
		<dropColumn tableName="crm_seller" columnName="credit_note_sequence_size" />

		<dropColumn tableName="ar_account_operation" columnName="credit_note_date" />

		<dropTable tableName="billing_credit_note_tax_amt" />
		<dropTable tableName="billing_credit_note_line" />
		<dropTable tableName="billing_credit_note" />
	</changeSet>

	<changeSet id="#1167_20151015" author="EdwardLegaspi">
		<addColumn tableName="crm_provider">
			<column name="invoice_adjustment_prefix" type="VARCHAR(255)" />
			<column name="current_invoice_adjustment_nb" type="BIGINT" />
			<column name="invoice_adjustment_sequence_size" type="INT4" />
		</addColumn>
		<addColumn tableName="crm_seller">
			<column name="invoice_adjustment_prefix" type="VARCHAR(255)" />
			<column name="current_invoice_adjustment_nb" type="BIGINT" />
			<column name="invoice_adjustment_sequence_size" type="INT4" />
		</addColumn>

		<addColumn tableName="billing_invoice">
			<column name="detailed_invoice" type="boolean" defaultValue="true" />
			<column name="invoice_id" type="BIGINT" />
		</addColumn>

		<addForeignKeyConstraint constraintName="fk_billing_invoice_adjusted_invoice"
			referencedTableName="billing_invoice" baseColumnNames="invoice_id"
			baseTableName="billing_invoice" referencedColumnNames="id" />

		<sql>UPDATE billing_invoice SET invoice_type='COMMERCIAL'</sql>
	</changeSet>

	<changeSet id="#1170_20151020" author="EdwardLegaspi">
		<addColumn tableName="billing_invoice_configuration">
			<column name="display_detail" type="BOOL" defaultValueBoolean="true"></column>
		</addColumn>
	</changeSet>
	
</databaseChangeLog>