<ui:composition xmlns="http://www.w3.org/1999/xhtml"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:h="http://java.sun.com/jsf/html" xmlns:hftl="http://hftl.org"
	xmlns:hf="http://java.sun.com/jsf/composite/tags"
	xmlns:pe="http://primefaces.org/ui/extensions"
	xmlns:c="http://java.sun.com/jsp/jstl/core"
	xmlns:p="http://primefaces.org/ui"
	xmlns:of="http://omnifaces.org/functions"
	xmlns:o="http://omnifaces.org/ui" xmlns:s="http://jboss.org/seam/faces"
	template="/marketingManager/layout/template.xhtml">

	<ui:define name="metadata">
		<f:metadata>
			<f:event type="preRenderView"
				listener="#{offerTemplateListBean.preRenderView}" />
			<f:viewParam name="tab" value="#{offerTemplateListBean.activeTab}" />
		</f:metadata>
	</ui:define>

	<ui:define name="navigation">
		<ui:include src="/marketingManager/layout/navigation.xhtml" />
	</ui:define>

	<ui:define name="body">
		<h:form id="crumbmenuForm">
			<p:breadCrumb homeDisplay="text" id="crumbmenu">
				<p:menuitem value="#{messages['menu.catalog']}" disabled="true" />
			</p:breadCrumb>
		</h:form>

		<p:panel header="#{messages['menu.marketingManager.catalogView']}">
			<p:panel style="width: 50%">
				<p:panelGrid columns="2" styleClass="ui-panelgrid-blank">
					<p:panel>
						<h:form>
							<ul class="ListNoStyle">
								<li class="Padding5"><p:link styleClass="fa fa-plus-circle"
										outcome="mmOfferTemplates"
										value=" #{messages['action.offer.create']}">
									</p:link></li>
							</ul>
						</h:form>
					</p:panel>

					<p:panel>
						<ul class="ListNoStyle">
							<li class="Padding5"><span class="fa fa-check-square-o"></span>
								#{offerTemplateListBean.countActive()}
								#{messages['page.catalog.offersAreActive']}</li>
							<li class="Padding5"><span class="fa fa-close"></span>
								#{offerTemplateListBean.countDisabled()}
								#{messages['page.catalog.offersAreDeactivated']}</li>
							<li class="Padding5"><span class="fa fa-exclamation-circle"></span>
								#{offerTemplateListBean.countExpiring()}
								#{messages['page.catalog.offersWillExpireSoon']}</li>
						</ul>
					</p:panel>
				</p:panelGrid>
			</p:panel>
			<p:panel style="width: 50%">
				<p:panelGrid columns="2" styleClass="ui-panelgrid-blank">
					<p:panel>
						<h:form>
							<div>
								<p:inputText placeholder="#{messages['action.search']}"
									value="#{offerTemplateListBean.filters['FIELD1_OR_FIELD2 name description']}" />
								<p:commandLink styleClass="Padding3 fa fa-search"
									update=":tabView"></p:commandLink>
<!-- 								<p:selectManyMenu id="searchOfferTemplateCat" -->
<!-- 									value="#{offerTemplateListBean.selOfferTemplateCategories}"> -->
<!-- 									<f:selectItem itemLabel="" itemValue="" -->
<!-- 										noSelectionOption="true" /> -->
<!-- 									<f:selectItems -->
<!-- 										value="#{offerTemplateCategoryBean.listActive()}" var="e" -->
<!-- 										itemLabel="#{e.descriptionOrCode}" itemValue="#{e}"></f:selectItems> -->
<!-- 									<s:objectConverter /> -->
<!-- 								</p:selectManyMenu> -->
							</div>
						</h:form>
					</p:panel>
					<p:panelGrid columns="1">
						<p:panel style="border: 1px solid #000" id="offerForExportPanel">
							<ul class="ListNoStyle">
								<li class="Padding5"><span class="fa fa-share-square-o"></span>
									<p:commandLink onclick="PF('exportableOffers').show();"
										value="#{offerTemplateListBean.selectedOfferTemplates.size()} #{messages['page.catalog.offersForExport']}">
									</p:commandLink></li>
								<li class="Padding5"><span class="fa fa-play"></span>
									#{messages['page.catalog.exportTo']} <p:selectOneMenu>
										<f:selectItem itemLabel="Production" itemValue="PROD" />
									</p:selectOneMenu></li>
							</ul>
						</p:panel>
					</p:panelGrid>
				</p:panelGrid>
			</p:panel>
			<p:tabView id="tabView"
				activeIndex="#{offerTemplateListBean.activeTab}">
				<p:tab title="#{messages['marketingManager.catalog.view.detailed']}">
					<h:form id="mainForm">
						<p:dataGrid id="dataGrid"
							value="#{offerTemplateListBean.listFromBOM()}" var="entity"
							paginator="true" rows="10" columns="1" layout="grid"
							paginatorTemplate="{RowsPerPageDropdown} {FirstPageLink} {PreviousPageLink} {CurrentPageReport} {NextPageLink} {LastPageLink}"
							lazy="true" styleClass="dataGrid custom-grid ui-datagrid-blank"
							rowsPerPageTemplate="10,15,20,50" rowKey="#{entity.id}">
							<p:panel styleClass="Wid40 VAlignTop">
								<p:panelGrid columns="4"
									styleClass="panelGrid ui-panelgrid-blank"
									columnClasses="Wid5 VAlignTop, Wid54 VAlignTop, Wid40 VAlignTop">
									<p:panel>
										<p:graphicImage id="offerImage" cache="false"
											value="#{offerTemplateImageStreamer.image}" height="100"
											width="100">
											<f:param name="id" value="#{entity.id}"></f:param>
										</p:graphicImage>
									</p:panel>
									<p:panel>
										<p:panelGrid columns="1" styleClass="ui-panelgrid-blank">
											<h:outputText value="#{entity.nameOrCode}"></h:outputText>
											<ui:repeat
												value="#{entity.offerTemplateCategories.toArray()}" var="c"
												varStatus="status">
												<c:set var="valueLabel" value="#{c}" />
												<c:set var="valueLabel"
													value="#{valueLabel['descriptionOrCode']}" />
												<h:outputText value="#{valueLabel}" />
												<h:outputText value=", " rendered="#{not status.last}" />
											</ui:repeat>
											<h:outputText
												value="#{messages['offerTemplate.bom']}: #{entity.businessOfferModel.code}"
												rendered="#{entity.businessOfferModel != null}"></h:outputText>
											<p:separator></p:separator>
											<h:outputText value="#{messages['commons.validFrom']}: "></h:outputText>
											<h:outputText value="#{entity.validFrom} ">
												<f:convertDateTime type="date"
													pattern="#{paramBean.getProperty('meveo.dateTimeFormat','dd/MM/yyyy HH:mm')}" />
											</h:outputText>
											<h:outputText value="#{messages['commons.validTo']}: "></h:outputText>
											<h:outputText value="#{entity.validTo} ">
												<f:convertDateTime type="date"
													pattern="#{paramBean.getProperty('meveo.dateTimeFormat','dd/MM/yyyy HH:mm')}" />
											</h:outputText>
										</p:panelGrid>
									</p:panel>
									<p:panel>
										<p:panel styleClass="TexAlRight">
											<div class="FRight">
												<p:inputSwitch value="#{entity.active}" disabled="true"
													onLabel="#{messages['accountStatusEnum.active']}"
													offLabel="#{messages['accountStatusEnum.inactive']}"></p:inputSwitch>
											</div>
											<div class="FRight"
												style="padding-top: 5px; margin-right: 10px;">#{messages['commons.status']}</div>
										</p:panel>
										<p:panel>
											<ul class="ListNoStyle" style="margin: 0px; padding: 0px;">
												<li class="Padding5 FRight"><p:commandLink
														styleClass="fa fa-share-square-o"
														update=":offerForExportPanel :dlgOfferExport"
														action="#{offerTemplateListBean.addForExport(entity)}">
													</p:commandLink></li>
												<li class="Padding5 FRight"><p:commandLink
														action="#{offerTemplateListBean.duplicate()}"
														update=":tabView" styleClass="fa fa-copy">
														<f:setPropertyActionListener
															target="#{offerTemplateListBean.entity}"
															value="#{entity}" />
														<f:param name="cid"
															value="#{javax.enterprise.context.conversation.id}" />
														<f:param name="tab" value="0"></f:param>
														<p:confirm header="#{messages['commons.duplicate']}"
															message="#{messages['commons.confirmDuplicate']}" />
													</p:commandLink></li>
												<li class="Padding5 FRight"><p:link
														styleClass="fa fa-edit" outcome="mmOfferDetail">
														<f:param name="cid"
															value="#{javax.enterprise.context.conversation.id}" />
														<f:param name="objectId" value="#{entity.id}"></f:param>
														<f:param name="edit" value="true"></f:param>
														<f:param name="backView" value="mmOffers"></f:param>
														<f:param name="tab" value="0"></f:param>
													</p:link></li>
												<li class="Padding5 FRight"><p:link
														outcome="mmOfferDetail" styleClass="fa fa-search-plus">
														<f:param name="cid"
															value="#{javax.enterprise.context.conversation.id}" />
														<f:param name="objectId" value="#{entity.id}"></f:param>
														<f:param name="edit" value="false"></f:param>
														<f:param name="backView" value="mmOffers"></f:param>
														<f:param name="tab" value="0"></f:param>
													</p:link></li>
											</ul>
										</p:panel>
									</p:panel>
								</p:panelGrid>
							</p:panel>
							<p:panel styleClass="VAlignTop" style="width: 59%;">
								<p:dataGrid value="#{entity.offerServiceTemplates}" var="ost"
									paginator="true" rows="20" columns="1"
									paginatorPosition="bottom" paginatorAlwaysVisible="false"
									paginatorTemplate="{RowsPerPageDropdown} {FirstPageLink} {PreviousPageLink} {CurrentPageReport} {NextPageLink} {LastPageLink}"
									lazy="true" styleClass="custom-grid ui-datagrid-blank"
									style="border: none;" rowKey="#{ost.id}">
									<p:panel>
										<h:outputText
											value="#{messages['offerServiceTemplate.serviceTemplate']}"
											styleClass="field-label"></h:outputText>: <h:outputText
											styleClass="field-value"
											value="#{ost.serviceTemplate.descriptionOrCode}"></h:outputText>
									</p:panel>
									<p:panel>
										<p:panel styleClass="Wid30 VAlignTop"
											header="#{messages['marketingManager.catalog.OneTimeFee']}">
											<p:dataList styleClass="dataList" paginatorPosition="bottom"
												paginatorAlwaysVisible="false"
												rendered="#{ost.serviceTemplate.serviceSubscriptionCharges != null}"
												value="#{ost.serviceTemplate.serviceSubscriptionCharges}"
												var="charge" type="ordered">
													#{charge.chargeTemplate.descriptionOrCode}
												</p:dataList>
										</p:panel>
										<p:panel styleClass="Wid30 VAlignTop"
											header="#{messages['marketingManager.catalog.recurringFee']}">
											<p:dataList styleClass="dataList" paginatorPosition="bottom"
												paginatorAlwaysVisible="false"
												rendered="#{ost.serviceTemplate.serviceRecurringCharges != null}"
												value="#{ost.serviceTemplate.serviceRecurringCharges}"
												var="charge" type="ordered">
													#{charge.chargeTemplate.descriptionOrCode}
											</p:dataList>
										</p:panel>
										<p:panel styleClass="Wid30 VAlignTop"
											header="#{messages['marketingManager.catalog.usageFee']}">
											<p:dataList styleClass="dataList" paginatorPosition="bottom"
												paginatorAlwaysVisible="false"
												rendered="#{ost.serviceTemplate.serviceUsageCharges != null}"
												value="#{ost.serviceTemplate.serviceUsageCharges}"
												var="charge" type="ordered">#{charge.chargeTemplate.descriptionOrCode}</p:dataList>
										</p:panel>
									</p:panel>
								</p:dataGrid>
							</p:panel>
						</p:dataGrid>
					</h:form>
				</p:tab>

				<p:tab id="tab1"
					title="#{messages['marketingManager.catalog.view.condensed']}">

					<hftl:dataList id="dataList" backingBean="#{offerTemplateListBean}"
						dataModel="#{offerTemplateListBean.listFromBOM()}"
						checkMany="false">
						<hftl:column label="#{messages['commons.nameOrCode']}"
							field="nameOrCode">
						</hftl:column>
						<hftl:column label="#{messages['commons.category']}"
							field="offerTemplateCategories" isList="true"
							valueLabelField="descriptionOrCode">
						</hftl:column>
						<hftl:column label="#{messages['commons.validFrom']}"
							field="validFrom" isDate="true">
						</hftl:column>
						<hftl:column label="#{messages['commons.validTo']}"
							field="validTo" isDate="true">
						</hftl:column>
						<p:column>
							<f:facet name="header">#{messages['commons.status']}</f:facet>
							<p:inputSwitch value="#{entity.active}" disabled="true"
								onLabel="#{messages['accountStatusEnum.active']}"
								offLabel="#{messages['accountStatusEnum.inactive']}"></p:inputSwitch>
						</p:column>
						<p:column>
							<p:link outcome="mmOfferDetail"
								styleClass="Padding5 fa fa-search-plus">
								<f:param name="cid"
									value="#{javax.enterprise.context.conversation.id}" />
								<f:param name="objectId" value="#{entity.id}"></f:param>
								<f:param name="edit" value="false"></f:param>
								<f:param name="backView" value="mmOffers"></f:param>
								<f:param name="tab" value="1"></f:param>
							</p:link>
							<p:link styleClass="Padding5 fa fa-edit" outcome="mmOfferDetail">
								<f:param name="cid"
									value="#{javax.enterprise.context.conversation.id}" />
								<f:param name="objectId" value="#{entity.id}"></f:param>
								<f:param name="edit" value="true"></f:param>
								<f:param name="backView" value="mmOffers"></f:param>
								<f:param name="tab" value="1"></f:param>
							</p:link>
							<p:commandLink action="#{offerTemplateListBean.duplicate()}"
								update=":tabView" styleClass="Padding5 fa fa-copy">
								<f:setPropertyActionListener
									target="#{offerTemplateListBean.entity}" value="#{entity}" />
								<f:param name="cid"
									value="#{javax.enterprise.context.conversation.id}" />
								<f:param name="tab" value="1"></f:param>
								<p:confirm header="#{messages['commons.duplicate']}"
									message="#{messages['commons.confirmDuplicate']}" />
							</p:commandLink>
							<p:commandLink styleClass="Padding5 fa fa-share-square-o"
								update=":offerForExportPanel :dlgOfferExport"
								action="#{offerTemplateListBean.addForExport(entity)}">
							</p:commandLink>
						</p:column>
					</hftl:dataList>
				</p:tab>
			</p:tabView>
		</p:panel>

		<p:dialog header="#{messages['offerTemplates']}"
			widgetVar="exportableOffers" minHeight="40" width="800"
			dynamic="true" modal="true" appendTo="@(body)">
			<h:form id="dlgOfferExport">
				<p:dataTable id="offers"
					value="#{offerTemplateListBean.selectedOfferTemplates}" var="e">
					<p:column headerText="#{messages['offerTemplate.name']}">#{e.name}</p:column>
					<p:column headerText="#{messages['BusinessEntity.code']}">#{e.code}</p:column>
					<p:column headerText="#{messages['BusinessEntity.description']}">#{e.description}</p:column>
					<p:column>
						<p:commandButton icon="fa fa-close"
							title="#{messages['button.closeButton']}"
							update="dlgOfferExport :offerForExportPanel"
							action="#{offerTemplateListBean.deleteForExport(e)}">
						</p:commandButton>
					</p:column>
				</p:dataTable>
			</h:form>
		</p:dialog>

	</ui:define>
</ui:composition>
