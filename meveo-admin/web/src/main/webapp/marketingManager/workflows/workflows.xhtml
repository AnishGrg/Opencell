<ui:composition xmlns="http://www.w3.org/1999/xhtml"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:h="http://java.sun.com/jsf/html" xmlns:hftl="http://hftl.org"
	xmlns:hf="http://java.sun.com/jsf/composite/tags"
	xmlns:pe="http://primefaces.org/ui/extensions"
	xmlns:c="http://java.sun.com/jsp/jstl/core"
	xmlns:p="http://primefaces.org/ui" xmlns:o="http://omnifaces.org/ui"
	template="/marketingManager/layout/template.xhtml">
    <ui:define name="metadata">
        <f:metadata>
            <f:event type="preRenderView"
                     listener="#{wfTransitionBean.preRenderView}" />
        </f:metadata>
    </ui:define>
    <ui:define name="body">
        <p:panel>
            <h:form id="crumbmenuForm">
                <p:breadCrumb homeDisplay="text" id="crumbmenu">
                    <p:menuitem value="#{messages['workflow.panel']}" disabled="true" />
                    <p:menuitem value="#{wfTransitionBean.workflowOrder.descriptionOrCode}" />
                </p:breadCrumb>
            </h:form>
        </p:panel>
        <p:panel styleClass="clearLeft">
            <p:panel style="width: 20%">
                <p:panel>
                    <div class="btn-wrapper">
                        <i class="fa fa-plus text-red"></i>
                        <p:link styleClass="no-text-decoration"
                                outcome="mmWorkflowDetail"
                                value=" #{messages['mmTransition.addNew']}">
                            <f:param name="cid"
                                     value="#{javax.enterprise.context.conversation.id}" />
                            <f:param name="edit" value="true" />
                        </p:link>
                    </div> <!-- / btn-wrapper -->
                </p:panel>
            </p:panel>
        </p:panel>
        <p:panel id="transitions" styleClass="clearLeft">
            <p:dataGrid id="transitionList"
                        value="#{wfTransitionBean.workflowOrder.transitions}" var="transition"
                        paginator="true" rows="10" columns="1" layout="grid"
                        paginatorTemplate="{RowsPerPageDropdown} {FirstPageLink} {PreviousPageLink} {CurrentPageReport} {NextPageLink} {LastPageLink}"
                        lazy="true" styleClass="dataGrid custom-grid ui-datagrid-blank"
                        rowsPerPageTemplate="10,15,20,50" rowKey="#{transition.id}">
                <p:panel styleClass="clearLeft" >
                    <hftl:decorateFormField fieldId="fromStatus"
                                            label="#{messages['dunningPlanTransition.fromStatus']}">
                        <h:outputText id="fromStatus" value="#{transition.fromStatus}"
                                      disabled="true" style="font-weight:bold;" />
                    </hftl:decorateFormField>

                    <hftl:decorateFormField fieldId="toStatus"
                                            label="#{messages['dunningPlanTransition.toStatus']}">
                        <h:outputText id="toStatus"
                                      value="#{transition.toStatus}"
                                      disabled="true" style="font-weight:bold;" />
                    </hftl:decorateFormField>

                    <hftl:decorateFormField fieldId="conditionEl"
                                            label="#{messages['dunningPlanTransition.conditionEl']}">
                        <h:outputText id="conditionEl"
                                      value="#{transition.conditionEl}"
                                      disabled="true" style="font-weight:bold;" />
                    </hftl:decorateFormField>
                </p:panel>
                <p:panel styleClass="clearLeft">
                    <p:panelGrid columns="2" styleClass="ui-panelgrid-blank">
                        <p:panel styleClass="text-center" style="margin-top: 0px;">
                            <p:panelGrid columns="2" styleClass="ui-panelgrid-blank">
                                <p:link styleClass="fa fa-edit fa-2x no-text-decoration text-red"
                                        outcome="mmWorkflowDetail">
                                    <f:param name="objectId" value="#{transition.id}"></f:param>
                                    <f:param name="cid"
                                             value="#{javax.enterprise.context.conversation.id}" />
                                    <f:param name="edit" value="true" />
                                </p:link>
                                <p:commandLink styleClass="fa fa-remove fa-2x no-text-decoration text-red" action="#{wfTransitionBean.deleteWfTransition(transition)}" ajax="true" update="transitions">
                                    <p:confirm header="#{messages['commons.confirmationHeader']}" message="#{messages['mmTransition.confirmDelete']}" icon="ui-icon-alert" />
                                </p:commandLink>
                            </p:panelGrid>
                        </p:panel>
                        <p:panel>
                            <p:dataTable var="rule" value="#{transition.wfTransitionRules}" rowIndexVar="rowIndex">
                                <p:column headerText="#{messages['mmTransition.selector']}">
                                    <h:outputText value="#{messages['mmTransition.and']}" rendered="#{rowIndex > 0}"/>
                                </p:column>

                                <p:column headerText="#{messages['mmTransition.criteria']}">
                                    <h:outputText value="#{rule.name}" />
                                </p:column>

                                <p:column headerText="#{messages['mmTransition.value']}" sortBy="#{rule.value}">
                                    <h:outputText value="#{rule.value}" />
                                </p:column>
                            </p:dataTable>
                        </p:panel>
                    </p:panelGrid>
                </p:panel>
                <p:panel styleClass="clearLeft">
                    <p:panelGrid columns="2" styleClass="ui-panelgrid-blank">
                        <p:panel>
                            <h:outputText value="#{messages['mmTransition.assignedTeam']}"></h:outputText>
                        </p:panel>
                        <p:panel>
                            <ui:repeat value="#{transition.wfActions.toArray()}"
                                       var="action" varStatus="status">
                                <c:set var="valueLabel" value="#{action.actionEl}" />
                                <h:outputText value="#{valueLabel}" />
                                <h:outputText value=", " rendered="#{not status.last}" />
                            </ui:repeat>
                         </p:panel>
                    </p:panelGrid>
                    <p:separator></p:separator>
                </p:panel>
            </p:dataGrid>
        </p:panel>
    </ui:define>
</ui:composition>