<ui:composition xmlns="http://www.w3.org/1999/xhtml"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:h="http://java.sun.com/jsf/html" xmlns:hftl="http://hftl.org"
	xmlns:hf="http://java.sun.com/jsf/composite/tags"
	xmlns:pe="http://primefaces.org/ui/extensions"
	xmlns:c="http://java.sun.com/jsp/jstl/core"
	xmlns:p="http://primefaces.org/ui" template="/layout/template.xhtml"
	xmlns:l="http://www.lapis.com/jsf/exporter">

	<ui:define name="metadata">
		<f:metadata>
			<f:event type="preRenderView"
				listener="#{mmOfferTemplateCategoryListBean.preRenderView}" />
		</f:metadata>
	</ui:define>

	<ui:define name="body">
		<h:form id="crumbmenuForm">
			<p:breadCrumb homeDisplay="text" id="crumbmenu">
				<p:menuitem value="#{messages['menu.catalog']}" disabled="true" />
				<p:menuitem value="#{messages['menu.catalog.offerCategories']}"
					outcome="mm_offerTemplateCategories" />
			</p:breadCrumb>
		</h:form>

		<p:panel>
			<h:form id="searchForm">
				<div style="float: right;" class="">
					<h:panelGrid
						styleClass="VAlignTop Wid100 ui-panelgrid-blank NoPadding"
						columnClasses="Wid95, Wid5" columns="2">
						<p:inputText id="searchField"
							value="#{mmOfferTemplateCategoryListBean.filters['fullText']}"
							placeholder="#{messages['action.search']}" />
						<p:commandButton id="searchButton" icon="fa fa-search" ajax="true"
							action="#{mmOfferTemplateCategoryListBean.search}"
							update=":mainForm:offerCategoriesTable" />
					</h:panelGrid>
					<p:defaultCommand target="searchButton" style="display: none;" />
				</div>
			</h:form>
		</p:panel>
		<h:form id="mainForm">
			<p:panel>
				<p:button id="buttonNew" icon="fa fa-plus"
					value=" #{messages['commons.new']}" styleClass="btn-theme-default"
					outcome="#{mmOfferTemplateCategoryListBean.newViewName}">
					<f:param name="cid"
						value="#{javax.enterprise.context.conversation.id}" />
					<f:param name="edit" value="true" />
					<f:param name="backView" value="mm_offerTemplateCategories" />
				</p:button>
			</p:panel>
			<p:panel id="offerCategoriesTable">
				<c:set var="hasData"
					value="#{mmOfferTemplateCategoryListBean.lazyDataModel and mmOfferTemplateCategoryListBean.lazyDataModel.getRowCount>0}" />
				<p:messages id="messages" />
				<p:panel styleClass="TexAlRight">
					<p:commandButton id="#{formId}buttonExportTop"
						styleClass="btn-theme-default" style="margin-right: 12px;"
						icon="ui-icon-xls" value="#{messages['commons.exportExcel']}"
						ajax="false">
						<p:dataExporter type="xls" target="mainForm:datatable_results"
							fileName="data" pageOnly="false" />
					</p:commandButton>
					<p:commandButton value="#{messages['export.exportToXml']}"
						styleClass="btn-theme-default"
						update=":#{p:component('exportParametersDialog')}"
						oncomplete="PF('exportParametersDialog').show()">
						<f:setPropertyActionListener
							target="#{entityExportImportBean.selectedExportTemplate}"
							value="#{null}" />
						<f:setPropertyActionListener
							target="#{entityExportImportBean.dataModelToExport}"
							value="#{mmOfferTemplateCategoryListBean.lazyDataModel}" />
						<f:setPropertyActionListener
							target="#{entityExportImportBean.selectedEntitiesToExport}"
							value="#{mmOfferTemplateCategoryListBean.selectedEntities}" />
					</p:commandButton>
				</p:panel>
				<hftl:dataList backingBean="#{mmOfferTemplateCategoryListBean}"
					editable="true" checkMany="false" prePaginatorControls="{Controls}"
					paginatorPosition="top" exportXlsxButton="false"
					exportToXml="false" sortBy="code">

					<p:column id="parent"
						headerText="#{messages['offer.parent.category']}"
						sortBy="#{entity.offerTemplateCategory.name}" exportable="true">
						<p:cellEditor>
							<f:facet name="output">
								<h:outputText value="#{entity.offerTemplateCategory.name}" />
							</f:facet>
							<f:facet name="input">
								<p:selectOneMenu id="parentCategory"
									value="#{entity.offerTemplateCategory}" required="false"
									converter="offerTemplateCategoryConverter" var="parent">
									<f:selectItem itemLabel="" />
									<f:selectItems
										value="#{mmOfferTemplateCategoryListBean.parentHierarchy}"
										var="parentCategory" itemLabel="#{parentCategory.code}"
										itemValue="#{parentCategory}" />
									<p:column>
										<h:outputText value="#{parent.codeInLevel}" />
									</p:column>
									<p:column>
										<h:outputText value="#{parent.name}" />
									</p:column>
								</p:selectOneMenu>
							</f:facet>
						</p:cellEditor>
					</p:column>
					<p:column id="code" headerText="#{messages['BusinessEntity.code']}"
						sortBy="#{entity.name}" exportable="true">
						<h:outputText value="#{entity.code}" />
					</p:column>
					<p:column id="name" headerText="#{messages['commons.name']}"
						sortBy="#{entity.name}" exportable="true">
						<p:cellEditor>
							<f:facet name="output">
								<h:outputText value="#{entity.name}" />
							</f:facet>
							<f:facet name="input">
								<p:inputText value="#{entity.name}" style="width:96%" />
							</f:facet>
						</p:cellEditor>
					</p:column>
					<p:column id="actions" exportable="false"
						styleClass="Wid10 TexAlCenter">
						<p:button id="editlink#{entity.id}"
							outcome="#{mmOfferTemplateCategoryListBean.getEditViewName()}"
							icon="fa fa-edit">
							<f:param name="objectId" value="#{entity.id}" />
							<f:param name="edit" value="true" />
							<f:param name="cid"
								value="#{javax.enterprise.context.conversation.id}" />
							<f:param name="backView" value="mm_offerTemplateCategories" />
						</p:button>
						<p:commandButton id="deleteButton#{entity.id}" icon="fa fa-trash"
							oncomplete="doDelete()">
							<f:setPropertyActionListener
								target="#{mmOfferTemplateCategoryListBean.entity}"
								value="#{entity}" />
							<p:confirm header="#{messages['commons.confirmationHeader']}"
								message="#{messages['commons.confirmDelete']}"
								icon="ui-icon-alert" />
						</p:commandButton>
					</p:column>
				</hftl:dataList>
			</p:panel>
			
			<hftl:exportToXmlDialogs messagesId=":#{p:component('messages')}" />
			<p:remoteCommand id="remoteDeleteButton" name="doDelete"
				action="#{mmOfferTemplateCategoryListBean.delete}" update="@form" />
		</h:form>
	</ui:define>
</ui:composition>
