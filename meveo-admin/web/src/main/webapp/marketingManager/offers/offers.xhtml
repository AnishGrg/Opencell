<ui:composition xmlns="http://www.w3.org/1999/xhtml"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:h="http://java.sun.com/jsf/html" xmlns:hftl="http://hftl.org"
	xmlns:hf="http://java.sun.com/jsf/composite/tags"
	xmlns:pe="http://primefaces.org/ui/extensions"
	xmlns:c="http://java.sun.com/jsp/jstl/core"
	xmlns:p="http://primefaces.org/ui"
	xmlns:of="http://omnifaces.org/functions"
	xmlns:o="http://omnifaces.org/ui" xmlns:s="http://jboss.org/seam/faces"
	template="/marketingManager/layout/template.xhtml">

	<ui:define name="metadata">
		<f:metadata>
			<f:event type="preRenderView"
				listener="#{offerTemplateListBean.preRenderView}" />
			<f:viewParam name="tab" value="#{offerTemplateListBean.activeTab}" />
		</f:metadata>
	</ui:define>

	<ui:define name="navigation">
		<ui:include src="/marketingManager/layout/navigation.xhtml" />
	</ui:define>

	<ui:define name="body">
		<h:form id="crumbmenuForm">
			<p:breadCrumb homeDisplay="text" id="crumbmenu">
				<p:menuitem value="#{messages['menu.catalog']}" disabled="true"
					styleClass="no-text-decoration" />
			</p:breadCrumb>
		</h:form>

		<div class="ui-fluid">
			<p:panel header="#{messages['menu.marketingManager.catalogView']}"
				styleClass="no-border-radius">
				<p:panel styleClass="Wid50 Responsive100">
					<div class="ui-fluid">
						<p:panelGrid columns="2" styleClass="ui-panelgrid-blank">
							<p:panel>
								<h:form>
									<ul class="ListNoStyle">
										<li class="Padding5">
											<div class="btn-wrapper">
												<i class="fa fa-plus text-blue"></i>
												<p:link styleClass="no-text-decoration"
													outcome="mm_offerTemplates"
													value=" #{messages['action.offer.create']}">
													<f:param name="backView" value="mm_offers" />
												</p:link>
											</div> <!-- / btn-wrapper -->
										</li>
									</ul>
								</h:form>
							</p:panel>

							<p:panel>
								<ul class="ListNoStyle">
									<li class="Padding5"><i
										class="fa fa-check-square-o text-blue"></i>
										#{offerTemplateListBean.countActive()}
										#{messages['page.catalog.offersAreActive']}</li>
									<li class="Padding5"><i class="fa fa-close text-blue"></i>
										#{offerTemplateListBean.countDisabled()}
										#{messages['page.catalog.offersAreDeactivated']}</li>
									<li class="Padding5"><i
										class="fa fa-exclamation-circle text-blue"></i>
										#{offerTemplateListBean.countExpiring()}
										#{messages['page.catalog.offersWillExpireSoon']}</li>
								</ul>
							</p:panel>
						</p:panelGrid>
					</div>
				</p:panel>
				<p:panel styleClass="Wid50 Responsive100 TexAlRight">
					<div class="Container">
						<p:panel styleClass="Container60 VAlignTop">
							<h:form>
								<div class="search-wrapper">
									<p:inputText placeholder="#{messages['action.search']}"
										value="#{offerTemplateListBean.filters['fullText']}" />
									<p:commandLink styleClass="Padding3 fa fa-search"
										update=":tabView"></p:commandLink>
									<!-- 								<p:selectManyMenu id="searchOfferTemplateCat" -->
									<!-- 									value="#{offerTemplateListBean.selOfferTemplateCategories}"> -->
									<!-- 									<f:selectItem itemLabel="" itemValue="" -->
									<!-- 										noSelectionOption="true" /> -->
									<!-- 									<f:selectItems -->
									<!-- 										value="#{offerTemplateCategoryBean.listActive()}" var="e" -->
									<!-- 										itemLabel="#{e.descriptionOrCode}" itemValue="#{e}"></f:selectItems> -->
									<!-- 									<s:objectConverter /> -->
									<!-- 								</p:selectManyMenu> -->
								</div>
								<!-- / search-wrapper -->
							</h:form>
						</p:panel>
						<p:panel columns="1" styleClass="Container40 no-border-radius"
							style="border: 1px solid #ddd" id="offerForExportPanel">
							<ul class="list-unstyled">
								<li class="Padding5"><i class="fa fa-share-square-o"
									style="margin-right: 5px;"></i> <p:commandLink
										onclick="PF('exportableOffers').show();"
										value="#{offerTemplateListBean.selectedOfferTemplates.size()} #{messages['page.catalog.offersForExport']}">
									</p:commandLink></li>
								<li>
									<div class="FRight">
										<p:commandLink styleClass="fa fa-play"
											style="margin-right: 5px;"
											value=" #{messages['page.catalog.exportTo']}"
											update=":#{p:component('exportParametersDialog')}"
											oncomplete="PF('exportParametersDialog').show()">
											<f:setPropertyActionListener
												target="#{entityExportImportBean.selectedExportTemplate}"
												value="#{offerTemplateBean.getMarketingCatalogExportTemplate()}" />
											<f:setPropertyActionListener
												target="#{entityExportImportBean.dataModelToExport}"
												value="#{offerTemplateListBean.listFromBOM()}" />
											<f:setPropertyActionListener
												target="#{entityExportImportBean.selectedEntitiesToExport}"
												value="#{offerTemplateListBean.selectedOfferTemplates}" />
										</p:commandLink>
									</div>
								</li>
							</ul>
						</p:panel>
					</div>
				</p:panel>

				<p:messages id="main_messages"></p:messages>
				<p:tabView id="tabView"
					activeIndex="#{offerTemplateListBean.activeTab}"
					styleClass="no-border-radius offer-wrapper">
					<p:tab
						title="#{messages['marketingManager.catalog.view.detailed']}">
						<h:form id="mainForm">
							<p:dataGrid id="dataGrid"
								value="#{offerTemplateListBean.listFromBOM()}" var="entity"
								paginator="true" rows="10" columns="1" layout="grid"
								paginatorTemplate="{RowsPerPageDropdown} {FirstPageLink} {PreviousPageLink} {CurrentPageReport} {NextPageLink} {LastPageLink}"
								lazy="true" styleClass="dataGrid custom-grid ui-datagrid-blank"
								rowsPerPageTemplate="10,15,20,50">
								<p:panel styleClass="Wid40 Responsive100 VAlignTop">
									<p:panelGrid columns="4"
										styleClass="panelGrid ui-panelgrid-blank"
										columnClasses="Wid5 VAlignTop Responsive100, Wid60 Responsive100 VAlignTop, Wid34 Responsive100 VAlignTop">
										<p:panel styleClass="">
											<p:graphicImage id="offerImage" cache="false"
												value="#{offerTemplateImageStreamer.image}" height="100"
												width="100">
												<f:param name="id" value="#{entity.id}"></f:param>
											</p:graphicImage>
										</p:panel>
										<p:panelGrid columns="1"
											styleClass="ui-panelgrid-blank Padding20">
											<p:panel styleClass="Wid100">
												<h:outputText value="#{entity.nameOrCode}"></h:outputText>
												<ui:repeat
													value="#{entity.offerTemplateCategories.toArray()}" var="c"
													varStatus="status">
													<c:set var="valueLabel" value="#{c}" />
													<c:set var="valueLabel"
														value="#{valueLabel['descriptionOrCode']}" />
													<h:outputText value="#{valueLabel}" />
													<h:outputText value=", " rendered="#{not status.last}" />
												</ui:repeat>
												<br />
												<h:outputText
													value="#{messages['offerTemplate.template']}: #{entity.businessOfferModel.code}"
													rendered="#{entity.businessOfferModel != null}"></h:outputText>
												<p:separator></p:separator>
												<p:panelGrid columns="3">
													<p:panelGrid columns="1"
														rendered="#{entity.validFrom ne null and entity.validFrom ne ''}">
														<h:outputText value="#{messages['commons.validFrom']}: "></h:outputText>
														<h:outputText value="#{entity.validFrom}">
															<f:convertDateTime type="date"
																pattern="#{paramBean.getProperty('meveo.dateTimeFormat','dd/MM/yyyy HH:mm')}" />
														</h:outputText>
													</p:panelGrid>
													<p:panel></p:panel>
													<p:panelGrid columns="1"
														rendered="#{entity.validTo ne null and entity.validTo ne ''}">
														<h:outputText value="#{messages['commons.validTo']}: "></h:outputText>
														<h:outputText value="#{entity.validTo}">
															<f:convertDateTime type="date"
																pattern="#{paramBean.getProperty('meveo.dateTimeFormat','dd/MM/yyyy HH:mm')}" />
														</h:outputText>
													</p:panelGrid>
												</p:panelGrid>
											</p:panel>
										</p:panelGrid>
										<p:panel styleClass="status-wrapper">
											<p:panel>
												<div class="text-bold" style="padding-bottom: 10px;">#{messages['commons.status']}</div>
												<div class="">
													<p:inputSwitch value="#{entity.active}" disabled="true"
														styleClass="#{entity.active ? 'GreenBg' : ''}"
														onLabel="#{messages['accountStatusEnum.active']}"
														offLabel="#{messages['accountStatusEnum.inactive']}"></p:inputSwitch>
												</div>
											</p:panel>
											<p:panel style="width: 200px;">
												<ul class="list-inline">
													<li><p:link id="viewLink"
															outcome="mm_offerTemplateDetail"
															styleClass="fa fa-search-plus no-text-decoration text-blue fa-2x">
															<f:param name="cid"
																value="#{javax.enterprise.context.conversation.id}" />
															<f:param name="objectId" value="#{entity.id}"></f:param>
															<f:param name="edit" value="false"></f:param>
															<f:param name="backView" value="mm_offers"></f:param>
															<f:param name="tab" value="0"></f:param>
														</p:link> <p:tooltip for="viewLink"
															value="#{messages['commons.view']}" showEffect="slide"
															hideEffect="slide" /></li>
													<li><p:link id="editLink"
															styleClass="fa fa-edit no-text-decoration text-blue fa-2x"
															outcome="mm_offerTemplateDetail">
															<f:param name="cid"
																value="#{javax.enterprise.context.conversation.id}" />
															<f:param name="objectId" value="#{entity.id}"></f:param>
															<f:param name="edit" value="true"></f:param>
															<f:param name="backView" value="mm_offers"></f:param>
															<f:param name="tab" value="0"></f:param>
														</p:link> <p:tooltip for="editLink"
															value="#{messages['commons.edit']}" showEffect="slide"
															hideEffect="slide" /></li>
													<li><p:commandLink id="duplicateLink"
															action="#{offerTemplateListBean.duplicate()}"
															update=":tabView"
															styleClass="fa fa-copy fa-2x no-text-decoration text-blue">
															<f:setPropertyActionListener value="#{entity}"
																target="#{offerTemplateListBean.entity}" />
															<f:param name="tab" value="0"></f:param>
															<p:confirm header="#{messages['commons.duplicate']}"
																message="#{messages['commons.confirmDuplicate']}" />
														</p:commandLink> <p:tooltip for="duplicateLink"
															value="#{messages['commons.duplicate']}"
															showEffect="slide" hideEffect="slide" /></li>
													<li><p:commandLink id="addToExportLink"
															styleClass="fa fa-share-square-o text-blue fa-2x"
															update=":offerForExportPanel :dlgOfferExport"
															action="#{offerTemplateListBean.addForExport(entity)}">
														</p:commandLink> <p:tooltip for="addToExportLink"
															value="#{messages['commons.addToExport']}"
															showEffect="slide" hideEffect="slide" /></li>
												</ul>
											</p:panel>
										</p:panel>
									</p:panelGrid>
								</p:panel>
								<p:panel styleClass="VAlignTop Wid60 Responsive100">
									<p:dataGrid value="#{entity.offerServiceTemplates}" var="ost"
										rendered="#{entity.offerServiceTemplates ne null and entity.offerServiceTemplates.size() > 0}"
										paginator="true" rows="20" columns="1"
										paginatorPosition="bottom" paginatorAlwaysVisible="false"
										paginatorTemplate="{RowsPerPageDropdown} {FirstPageLink} {PreviousPageLink} {CurrentPageReport} {NextPageLink} {LastPageLink}"
										lazy="true"
										styleClass="custom-grid ui-datagrid-blank dataGrid"
										style="border: none;">
										<p:panel styleClass="">
											<h:outputText
												value="#{messages['offerServiceTemplate.serviceTemplate']}"
												styleClass="field-label"></h:outputText>: <h:outputText
												styleClass="field-value"
												value="#{ost.serviceTemplate.descriptionOrCode}"></h:outputText>
										</p:panel>
										<p:panel>
											<p:panel
												styleClass="Wid30 Responsive100 VAlignTop border-left no-border-radius"
												header="#{messages['marketingManager.catalog.OneTimeFee']}"
												rendered="#{ost.serviceTemplate.serviceSubscriptionCharges != null and ost.serviceTemplate.serviceSubscriptionCharges.size() > 0}">
												<p:dataList styleClass="dataList" paginatorPosition="bottom"
													paginatorAlwaysVisible="false"
													value="#{ost.serviceTemplate.serviceSubscriptionCharges}"
													var="charge" type="ordered">
													#{charge.chargeTemplate.descriptionOrCode}
												</p:dataList>
											</p:panel>
											<p:panel
												styleClass="Wid30 Responsive100 VAlignTop border-left no-border-radius"
												header="#{messages['marketingManager.catalog.recurringFee']}"
												rendered="#{ost.serviceTemplate.serviceRecurringCharges != null and ost.serviceTemplate.serviceRecurringCharges.size() > 0}">
												<p:dataList styleClass="dataList" paginatorPosition="bottom"
													paginatorAlwaysVisible="false"
													value="#{ost.serviceTemplate.serviceRecurringCharges}"
													var="charge" type="ordered">
													#{charge.chargeTemplate.descriptionOrCode}
											</p:dataList>
											</p:panel>
											<p:panel
												styleClass="Wid30 Responsive100 VAlignTop border-left no-border-radius"
												header="#{messages['marketingManager.catalog.usageFee']}"
												rendered="#{ost.serviceTemplate.serviceUsageCharges != null and ost.serviceTemplate.serviceUsageCharges.size() > 0}">
												<p:dataList styleClass="dataList" paginatorPosition="bottom"
													paginatorAlwaysVisible="false"
													value="#{ost.serviceTemplate.serviceUsageCharges}"
													var="charge" type="ordered">#{charge.chargeTemplate.descriptionOrCode}</p:dataList>
											</p:panel>
										</p:panel>
									</p:dataGrid>
								</p:panel>
							</p:dataGrid>
						</h:form>
					</p:tab>

					<p:tab id="tab1"
						title="#{messages['marketingManager.catalog.view.condensed']}">

						<hftl:dataList id="dataList"
							backingBean="#{offerTemplateListBean}"
							dataModel="#{offerTemplateListBean.listFromBOM()}"
							checkMany="false" exportToCsv="false" exportToXml="false"
							exportXlsxButton="false" sortOrder="DESCENDING"
							styleClass="DataListCenter">
							<hftl:column label="#{messages['commons.nameOrCode']}"
								field="nameOrCode">
							</hftl:column>
							<hftl:column label="#{messages['commons.category']}"
								field="offerTemplateCategories" isList="true"
								valueLabelField="descriptionOrCode">
							</hftl:column>
							<hftl:column label="#{messages['commons.validFrom']}"
								field="validFrom" isDate="true">
							</hftl:column>
							<hftl:column label="#{messages['commons.validTo']}"
								field="validTo" isDate="true">
							</hftl:column>
							<p:column>
								<f:facet name="header">#{messages['commons.status']}</f:facet>
								<p:inputSwitch value="#{entity.active}" disabled="true"
									onLabel="#{messages['accountStatusEnum.active']}"
									offLabel="#{messages['accountStatusEnum.inactive']}"></p:inputSwitch>
							</p:column>
							<p:column>
								<p:link outcome="mm_offerTemplateDetail"
									styleClass="Padding5 fa fa-search-plus no-text-decoration fa-2x text-blue">
									<f:param name="cid"
										value="#{javax.enterprise.context.conversation.id}" />
									<f:param name="objectId" value="#{entity.id}"></f:param>
									<f:param name="edit" value="false"></f:param>
									<f:param name="backView" value="mm_offers"></f:param>
									<f:param name="tab" value="1"></f:param>
								</p:link>
								<p:link
									styleClass="Padding5 fa fa-edit no-text-decoration fa-2x text-blue"
									outcome="mm_offerTemplateDetail">
									<f:param name="cid"
										value="#{javax.enterprise.context.conversation.id}" />
									<f:param name="objectId" value="#{entity.id}"></f:param>
									<f:param name="edit" value="true"></f:param>
									<f:param name="backView" value="mm_offers"></f:param>
									<f:param name="tab" value="1"></f:param>
								</p:link>
								<p:commandLink action="#{offerTemplateListBean.duplicate()}"
									update=":tabView"
									styleClass="Padding5 fa fa-copy no-text-decoration text-blue fa-2x">
									<f:setPropertyActionListener
										target="#{offerTemplateListBean.entity}" value="#{entity}" />
									<f:param name="tab" value="1"></f:param>
									<p:confirm header="#{messages['commons.duplicate']}"
										message="#{messages['commons.confirmDuplicate']}" />
								</p:commandLink>
								<p:commandLink
									styleClass="Padding5 fa fa-share-square-o no-text-decoration fa-2x text-blue"
									update=":offerForExportPanel :dlgOfferExport"
									action="#{offerTemplateListBean.addForExport(entity)}">
								</p:commandLink>
							</p:column>
						</hftl:dataList>
					</p:tab>
				</p:tabView>

				<hftl:exportToXmlDialogs
					messagesId=":#{p:component('main_messages')}" />
			</p:panel>
		</div>

		<p:dialog header="#{messages['offerTemplates']}"
			widgetVar="exportableOffers" minHeight="40" width="800"
			dynamic="true" modal="true" appendTo="@(body)">
			<h:form id="dlgOfferExport">
				<p:dataTable id="offers" reflow="true"
					value="#{offerTemplateListBean.selectedOfferTemplates}" var="e">
					<p:column headerText="#{messages['offerTemplate.name']}">#{e.name}</p:column>
					<p:column headerText="#{messages['BusinessEntity.code']}">#{e.code}</p:column>
					<p:column headerText="#{messages['BusinessEntity.description']}">#{e.description}</p:column>
					<p:column>
						<p:commandButton icon="fa fa-close"
							title="#{messages['button.closeButton']}"
							update="dlgOfferExport :offerForExportPanel"
							action="#{offerTemplateListBean.deleteForExport(e)}">
						</p:commandButton>
					</p:column>
				</p:dataTable>
			</h:form>
		</p:dialog>

	</ui:define>
</ui:composition>
