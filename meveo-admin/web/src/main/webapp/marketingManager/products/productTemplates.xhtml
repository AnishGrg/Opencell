<ui:composition xmlns="http://www.w3.org/1999/xhtml"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:h="http://java.sun.com/jsf/html" xmlns:hftl="http://hftl.org"
	xmlns:hf="http://java.sun.com/jsf/composite/tags"
	xmlns:pe="http://primefaces.org/ui/extensions"
	xmlns:c="http://java.sun.com/jsp/jstl/core"
	xmlns:p="http://primefaces.org/ui" xmlns:o="http://omnifaces.org/ui"
	template="/marketingManager/layout/template.xhtml">
	<ui:define name="metadata">
		<f:metadata>
			<f:event type="preRenderView"
				listener="#{productTemplateListBean.preRenderView}" />
			<f:viewParam name="tab" value="#{productTemplateListBean.activeTab}" />
		</f:metadata>
	</ui:define>

	<ui:define name="navigation">
		<ui:include src="/marketingManager/layout/navigation.xhtml" />
	</ui:define>

	<ui:define name="body">

		<p:breadCrumb homeDisplay="text" id="crumbmenu">
			<p:menuitem value="#{messages['menu.catalog']}" disabled="true"
				styleClass="no-text-decoration" />
		</p:breadCrumb>
		<p:panel header="#{messages['productTemplates.search']}"
			styleClass="no-border-radius">
			<p:panel styleClass="Wid50">
				<p:panelGrid columns="2" styleClass="ui-panelgrid-blank">
					<p:panel>
						<h:form>
							<ul class="ListNoStyle">
								<li class="Padding5">
									<div class="btn-wrapper">
										<i class="fa fa-plus text-red"></i>
										<p:link styleClass="no-text-decoration"
											outcome="mm_productTemplateDetail"
											value=" #{messages['productTemplate.newProduct']}">
											<f:param name="cid"
												value="#{javax.enterprise.context.conversation.id}" />
											<f:param name="edit" value="true" />
											<f:param name="editMode" value="edit" />
										</p:link>
									</div> <!-- / btn-wrapper -->
								</li>
							</ul>
							<ul class="ListNoStyle">
								<li class="Padding5">
									<div class="btn-wrapper">
										<i class="fa fa-plus text-red"></i>
										<p:link styleClass="no-text-decoration"
											outcome="mm_bundleTemplateDetail"
											value=" #{messages['productTemplate.createBundle']}">
											<f:param name="cid"
												value="#{javax.enterprise.context.conversation.id}" />
											<f:param name="edit" value="true" />
											<f:param name="editMode" value="edit" />
										</p:link>
									</div> <!-- / btn-wrapper -->
								</li>
							</ul>

						</h:form>
					</p:panel>

					<p:panel>
						<ul class="ListNoStyle">
							<li class="Padding5"><i
								class="fa fa-check-square-o text-red"></i>
								#{productTemplateListBean.activeProductCount}
								#{messages['productTemplate.activeProductsNum']}</li>
							<li class="Padding5"><i class="fa fa-close text-red"></i>
								#{productTemplateListBean.inactiveProductCount}
								#{messages['productTemplate.deactivatedProductsNum']}</li>
							<li class="Padding5"><i
								class="fa fa-exclamation-circle text-red"></i>
								#{productTemplateListBean.almostExpiredCount}
								#{messages['productTemplate.expiringProductsNum']}</li>
						</ul>
					</p:panel>
				</p:panelGrid>
			</p:panel>
			<p:panel id="ptToExport" styleClass="Wid50 TexAlRight">
				<div class="Container">
					<p:panel styleClass="Container60 VAlignTop">
						<h:form>
							<div class="search-wrapper">
								<p:inputText placeholder="#{messages['action.search']}"
									value="#{productTemplateListBean.filters['fullText']}" />
								<p:commandLink styleClass="Padding3 fa fa-search"
									update=":#{p:component('productTemplateList')}"></p:commandLink>
							</div>
						</h:form>
					</p:panel>
					<p:panel columns="1" styleClass="Container40 no-border-radius"
						style="border: 1px solid #ddd" id="productForExportPanel">
						<ul class="list-unstyled">
							<li class="Padding5"><i class="fa fa-share-square-o"
								style="margin-right: 5px;"></i> <p:commandLink
									onclick="PF('exportablePTs').show();"
									value="#{productTemplateListBean.ptToExport.size()} #{messages['productTemplate.selectedProductsfoExportNum']}">
								</p:commandLink></li>
							<li>
								<div class="FRight">
									<p:commandLink styleClass="fa fa-play"
										style="margin-right: 5px;"
										value=" #{messages['page.catalog.exportTo']}"
										update=":#{p:component('exportParametersDialog')}"
										oncomplete="PF('exportParametersDialog').show()">
										<f:setPropertyActionListener
											target="#{entityExportImportBean.dataModelToExport}"
											value="#{productTemplateListBean.getLazyDataModel()}" />
										<f:setPropertyActionListener
											target="#{entityExportImportBean.selectedEntitiesToExport}"
											value="#{productTemplateListBean.ptToExport}" />
									</p:commandLink>
								</div>
							</li>
						</ul>
					</p:panel>
				</div>
			</p:panel>

			<p:messages id="main_messages"></p:messages>
			<p:tabView id="tabView" styleClass="no-border-radius offer-wrapper"
				activeIndex="#{productTemplateListBean.activeTab}">
				<p:tab title="#{messages['marketingManager.catalog.view.detailed']}">
					<h:form id="productTemplateForm">
						<p:dataGrid id="productTemplateList"
							value="#{productTemplateListBean.getLazyDataModel()}" var="prod"
							paginator="true" rows="10" columns="1" layout="grid"
							paginatorTemplate="{RowsPerPageDropdown} {FirstPageLink} {PreviousPageLink} {CurrentPageReport} {NextPageLink} {LastPageLink}"
							lazy="true" styleClass="dataGrid custom-grid ui-datagrid-blank"
							rowsPerPageTemplate="10,15,20,50" rowKey="#{prod.id}">
							<p:panel styleClass="Wid50 VAlignTop">
								<p:panelGrid columns="4"
									styleClass="panelGrid ui-panelgrid-blank"
									columnClasses="Wid5 VAlignTop, Wid54 VAlignTop, Wid40 VAlignTop">
									<p:panel>
										<p:graphicImage id="productImage" cache="false"
											rendered="#{prod ne null}"
											value="#{productTemplateImageStreamer.image}" width="100">
											<f:param name="id" value="#{prod.id}"></f:param>
										</p:graphicImage>
									</p:panel>
									<p:panel>
										<p:panelGrid columns="1" styleClass="ui-panelgrid-blank">
											<h:outputText value="#{prod.nameOrCode}"></h:outputText>
											<ui:repeat value="#{prod.offerTemplateCategories.toArray()}"
												var="c" varStatus="status">
												<c:set var="valueLabel" value="#{c}" />
												<c:set var="valueLabel"
													value="#{valueLabel['descriptionOrCode']}" />
												<h:outputText value="#{valueLabel}" />
												<h:outputText value=", " rendered="#{not status.last}" />
											</ui:repeat>
											<h:outputText
												value="#{prod.businessProductModel.code}"
												rendered="#{prod.businessProductModel != null}"></h:outputText>
											<p:separator></p:separator>
											<p:panelGrid columns="3">
												<p:panelGrid columns="1" rendered="#{prod.validFrom ne null and prod.validFrom ne ''}">
													<h:outputText value="#{messages['commons.validFrom']}: "></h:outputText>
													<h:outputText value="#{prod.validFrom}">
												<f:convertDateTime type="date"
													pattern="#{paramBean.getProperty('meveo.dateTimeFormat','dd/MM/yyyy HH:mm')}" />
											</h:outputText>
												</p:panelGrid>
												<p:panel></p:panel>
												<p:panelGrid columns="1" rendered="#{prod.validTo ne null and prod.validTo ne ''}">
													<h:outputText value="#{messages['commons.validTo']}: "></h:outputText>
													<h:outputText value="#{prod.validTo}">
												<f:convertDateTime type="date"
													pattern="#{paramBean.getProperty('meveo.dateTimeFormat','dd/MM/yyyy HH:mm')}" />
											</h:outputText>
												</p:panelGrid>
											</p:panelGrid>
										</p:panelGrid>
									</p:panel>
									<p:panel>
										<p:panel styleClass="TexAlRight">
											<div class="FRight">
												<p:inputSwitch value="#{prod.active}" disabled="true" styleClass="#{prod.active ? 'GreenBg' : ''}"
													onLabel="#{messages['accountStatusEnum.active']}"
													offLabel="#{messages['accountStatusEnum.inactive']}"></p:inputSwitch>
											</div>
											<div class="FRight"
												style="padding-top: 5px; margin-right: 10px;">#{messages['commons.status']}</div>
										</p:panel>
										<p:panel styleClass="text-center">
											<ul class="list-inline">
												<li><p:link outcome="mm_productTemplateDetail"
														styleClass="fa fa-search-plus fa-2x no-text-decoration text-red"
														rendered="#{not productTemplateBean.isBundleTemplate(prod)}">
														<f:param name="cid"
															value="#{javax.enterprise.context.conversation.id}" />
														<f:param name="objectId" value="#{prod.id}"></f:param>
														<f:param name="edit" value="false"></f:param>
														<f:param name="backView" value="mm_productTemplates"></f:param>
														<f:param name="tab" value="0"></f:param>
													</p:link> <p:link outcome="mm_bundleTemplateDetail"
														styleClass="fa fa-search-plus fa-2x no-text-decoration text-red"
														rendered="#{productTemplateBean.isBundleTemplate(prod)}">
														<f:param name="cid"
															value="#{javax.enterprise.context.conversation.id}" />
														<f:param name="objectId" value="#{prod.id}"></f:param>
														<f:param name="edit" value="false"></f:param>
														<f:param name="backView" value="mm_productTemplates"></f:param>
														<f:param name="tab" value="0"></f:param>
													</p:link></li>
												<li><p:link
														styleClass="fa fa-edit fa-2x no-text-decoration text-red"
														outcome="mm_productTemplateDetail"
														rendered="#{not productTemplateBean.isBundleTemplate(prod)}">
														<f:param name="objectId" value="#{prod.id}" />
														<f:param name="cid"
															value="#{javax.enterprise.context.conversation.id}" />
														<f:param name="edit" value="true" />
														<f:param name="editMode" value="edit" />
														<f:param name="backView" value="mm_productTemplates"></f:param>
													</p:link> <p:link
														styleClass="fa fa-edit fa-2x no-text-decoration text-red"
														outcome="mm_bundleTemplateDetail"
														rendered="#{productTemplateBean.isBundleTemplate(prod)}">
														<f:param name="objectId" value="#{prod.id}"></f:param>
														<f:param name="cid"
															value="#{javax.enterprise.context.conversation.id}" />
														<f:param name="edit" value="true" />
														<f:param name="editMode" value="edit" />
														<f:param name="backView" value="mm_productTemplates"></f:param>
													</p:link></li>
												<li><p:commandLink
														rendered="#{not productTemplateBean.isBundleTemplate(prod)}"
														styleClass="fa fa-copy fa-2x text-red"
														action="#{productTemplateBean.duplicate()}"
														update=":tabView">
														<f:param name="tab" value="0"></f:param>
														<f:setPropertyActionListener value="#{prod}"
															target="#{productTemplateBean.entity}"></f:setPropertyActionListener>
														<f:param name="tab" value="0"></f:param>
														<p:confirm header="#{messages['commons.duplicate']}"
															message="#{messages['commons.confirmDuplicate']}" />
													</p:commandLink> <p:commandLink
														rendered="#{productTemplateBean.isBundleTemplate(prod)}"
														styleClass="fa fa-copy fa-2x text-red"
														action="#{bundleTemplateBean.duplicate()}"
														update=":tabView">
														<f:param name="tab" value="0"></f:param>
														<f:setPropertyActionListener value="#{prod}"
															target="#{bundleTemplateBean.entity}"></f:setPropertyActionListener>
														<f:param name="tab" value="0"></f:param>
														<p:confirm header="#{messages['commons.duplicate']}"
															message="#{messages['commons.confirmDuplicate']}" />
													</p:commandLink></li>
												<li><p:commandLink
														styleClass="fa fa-share-square-o fa-2x text-red"
														action="#{productTemplateListBean.addProductTemplateToExport(prod)}"
														update=":ptToExport :exportablePTs">
													</p:commandLink></li>
											</ul>
										</p:panel>
									</p:panel>
								</p:panelGrid>
							</p:panel>
						</p:dataGrid>
					</h:form>
				</p:tab>

				<p:tab id="tab1"
					title="#{messages['marketingManager.catalog.view.condensed']}">
					<hftl:dataList id="dataList" backingBean="#{offerTemplateListBean}"
						dataModel="#{productTemplateListBean.getLazyDataModel()}"
						checkMany="false" exportToCsv="false" exportToXml="false"
						exportXlsxButton="false" sortOrder="DESCENDING" styleClass="DataListCenter">
						<hftl:column label="#{messages['commons.nameOrCode']}"
							field="nameOrCode">
						</hftl:column>
						<hftl:column label="#{messages['commons.category']}"
							field="offerTemplateCategories" isList="true"
							valueLabelField="descriptionOrCode">
						</hftl:column>
						<hftl:column label="#{messages['commons.validFrom']}"
							field="validFrom" isDate="true">
						</hftl:column>
						<hftl:column label="#{messages['commons.validTo']}"
							field="validTo" isDate="true">
						</hftl:column>
						<p:column>
							<f:facet name="header">#{messages['commons.status']}</f:facet>
							<p:inputSwitch value="#{entity.active}" disabled="true"
								onLabel="#{messages['accountStatusEnum.active']}"
								offLabel="#{messages['accountStatusEnum.inactive']}"></p:inputSwitch>
						</p:column>
						<p:column>
							<ul class="list-inline">
								<li><p:link outcome="mm_productTemplateDetail"
										styleClass="fa fa-search-plus fa-2x no-text-decoration text-red">
										<f:param name="cid"
											value="#{javax.enterprise.context.conversation.id}" />
										<f:param name="objectId" value="#{entity.id}"></f:param>
										<f:param name="edit" value="false"></f:param>
										<f:param name="backView" value="mm_productTemplates"></f:param>
										<f:param name="tab" value="1"></f:param>
									</p:link></li>
								<li
									class="#{not productTemplateBean.isBundleTemplate(entity) ? '' : 'hidden'}">
									<p:link
										styleClass="fa fa-edit fa-2x no-text-decoration text-red"
										outcome="mm_productTemplateDetail"
										rendered="#{not productTemplateBean.isBundleTemplate(entity)}">
										<f:param name="objectId" value="#{prod.id}">
										</f:param>
										<f:param name="cid"
											value="#{javax.enterprise.context.conversation.id}" />
										<f:param name="edit" value="true" />
										<f:param name="editMode" value="edit" />
										<f:param name="backView" value="mm_productTemplates"></f:param>
									</p:link>
								</li>
								<li
									class="#{productTemplateBean.isBundleTemplate(entity) ? '' : 'hidden'}">
									<p:link
										styleClass="fa fa-edit fa-2x no-text-decoration text-red"
										outcome="mm_bundleTemplateDetail"
										rendered="#{productTemplateBean.isBundleTemplate(entity)}">
										<f:param name="objectId" value="#{entity.id}"></f:param>
										<f:param name="cid"
											value="#{javax.enterprise.context.conversation.id}" />
										<f:param name="edit" value="true" />
										<f:param name="editMode" value="edit" />
										<f:param name="backView" value="mm_productTemplates"></f:param>
									</p:link>
								</li>
								<li><p:commandLink
										rendered="#{not productTemplateBean.isBundleTemplate(entity)}"
										styleClass="fa fa-copy fa-2x text-red"
										action="#{productTemplateBean.duplicate()}" update=":tabView">
										<f:param name="tab" value="1"></f:param>
										<f:setPropertyActionListener value="#{entity}"
											target="#{productTemplateBean.entity}"></f:setPropertyActionListener>
										<p:confirm header="#{messages['commons.duplicate']}"
											message="#{messages['commons.confirmDuplicate']}" />
									</p:commandLink> <p:commandLink
										rendered="#{productTemplateBean.isBundleTemplate(entity)}"
										styleClass="fa fa-copy fa-2x text-red"
										action="#{bundleTemplateBean.duplicate()}" update=":tabView">
										<f:param name="tab" value="1"></f:param>
										<f:setPropertyActionListener value="#{entity}"
											target="#{bundleTemplateBean.entity}"></f:setPropertyActionListener>
										<p:confirm header="#{messages['commons.duplicate']}"
											message="#{messages['commons.confirmDuplicate']}" />
									</p:commandLink></li>
								<li><p:commandLink
										styleClass="fa fa-share-square-o fa-2x no-text-decoration text-red"
										action="#{productTemplateListBean.addProductTemplateToExport(entity)}"
										update=":ptToExport :exportablePTs">
									</p:commandLink></li>
							</ul>
						</p:column>
					</hftl:dataList>
				</p:tab>
			</p:tabView>

			<hftl:exportToXmlDialogs
				messagesId=":#{p:component('main_messages')}" />
		</p:panel>

		<p:dialog id="exportablePTs"
			header="#{messages['productTemplates.title']}"
			widgetVar="exportablePTs" minHeight="40" width="800" dynamic="true"
			modal="true" appendTo="@(body)">
			<h:form id="dlgPTExport">
				<p:dataTable id="offers"
					value="#{productTemplateListBean.ptToExport}" var="e">
					<p:column headerText="#{messages['offerTemplate.name']}">#{e.name}</p:column>
					<p:column headerText="#{messages['BusinessEntity.code']}">#{e.code}</p:column>
					<p:column headerText="#{messages['BusinessEntity.description']}">#{e.description}</p:column>
					<p:column>
						<p:commandButton icon="fa fa-close"
							title="#{messages['button.closeButton']}"
							update="dlgPTExport :ptToExport"
							action="#{productTemplateListBean.deleteForExport(e)}">
						</p:commandButton>
					</p:column>
				</p:dataTable>
			</h:form>
		</p:dialog>

	</ui:define>

</ui:composition>
