<ui:composition xmlns="http://www.w3.org/1999/xhtml"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:h="http://java.sun.com/jsf/html" xmlns:hftl="http://hftl.org"
	xmlns:p="http://primefaces.org/ui"
	xmlns:c="http://java.sun.com/jsp/jstl/core"
	xmlns:hf="http://java.sun.com/jsf/composite/tags"
	template="/layout/template.xhtml">

	<ui:define name="navigation">
		<ui:include src="/layout/navigation.xhtml" />
	</ui:define>

	<ui:define name="body">
	
	<hftl:entityPopup id="searchInvoiceCategoryPopup"
			header="#{messages['invoiceCategory.panel']}"
			updateField=":tabView:discountPlanItemFormPanel:formDiscountPlanItem:categorySelectId:categorySelectId"
			selection="#{discountPlanItem.invoiceCategory}"
			backingBean="#{invoiceCategoryBean}"
			searchField1Label="#{messages['invoiceCategory.code']}"
			searchField1="code"
			searchField2Label="#{messages['invoiceCategory.description']}"
			searchField2="description"
			column1Label="#{messages['invoiceCategory.code']}" column1="code"
			column2Label="#{messages['invoiceCategory.description']}"
			column2="description" />
			
			<hftl:entityPopup id="searchInvoiceSubCategoryPopup"
			header="#{messages['invoiceSubCategory.panel']}"
			backingBean="#{invoiceSubCategoryBean}"
			updateField=":tabView:discountPlanItemFormPanel:formDiscountPlanItem:invoiceSubCategorySelectedId:invoiceSubCategorySelectedId"
			selection="#{discountPlanItem.invoiceSubCategory}"
			searchField1Label="#{messages['invoiceSubCategory.code']}"
			searchField1="code"
			searchField2Label="#{messages['invoiceSubCategory.description']}"
			searchField2="description"
			column1Label="#{messages['invoiceSubCategory.code']}" column1="code"
			column2Label="#{messages['invoiceSubCategory.description']}"
			column2="description"/>
			
		<p:panel styleClass="form-panel">

			<p:tabView id="tabView">

				<p:tab title="#{messages['commons.information']}">
					<hf:formPanel edit="#{edit}" id="discountFormPanel"
						formId="formDiscountPlan"
						label="#{messages['discountPlanMatrix.panel']}"
						backingBean="#{discountPlanBean}" columns="2"
						showEnableDisableButton="true">
						<hf:formField id="chargeSelectId" required="true"
							label="#{messages['discountPlanMatrix.eventCode']}" field="code" />
						<hf:formField label="#{messages['BusinessEntity.description']}"
							field="description" required="true" useConverter="false"
							id="description" maxlength="50" />
						<hf:formField label="#{messages['enableEntity.disabled']}"
							field="disabled" isMessage="true" showOnlyOnConsult="true" />
						<hf:formField
							label="#{messages['pricePlanMatrix.minSubscriptionAgeInMonth']}"
							field="minDuration" />
						<hf:formField
							label="#{messages['pricePlanMatrix.maxSubscriptionAgeInMonth']}"
							field="maxDuration" />
					</hf:formPanel>
				</p:tab>

				<p:tab title="#{messages['discountPlanItem.title']}"
					rendered="#{!discountPlanBean.entity.transient}">
					<p:outputPanel id="discountPlanItems_MSG_panel">
						<h:graphicImage value="/img/msgerror.png" style="border:0"
							rendered="#{validation.failed}" />
						<h:outputText value="#{messages['validation.validationFailure']}"
							rendered="#{validation.failed}" styleClass="errorMessage" />
					</p:outputPanel>

					<p:panel id="discountPlanItemPanel">

						<hftl:dataList id="discountPlanItemsList"
							label="#{messages['discountPlan.title']}"
							backingBean="#{discountPlanItemBean}" sortBy="code"
							dataModel="#{discountPlanBean.entity.discountPlanItems}">
							<hftl:column label="#{messages['BusinessEntity.code']}"
								field="code" />
								
							<hftl:column label="#{messages['discountPlanMatrix.itemCode']}"
								field="discountPlan" childField="code" />
							<hftl:column
								label="#{messages['discountPlanItem.invoiceCategory']}"
								field="invoiceCategory" childField="code" />
							<hftl:column
								label="#{messages['discountPlanItem.invoiceSubCategory']}"
								field="invoiceSubCategory" childField="code" />
							<hftl:column label="#{messages['discountPlanItem.percent']}"
								field="percent" />

							<p:column styleClass="actions-column"
								rendered="#{discountPlanBean.edit}">
								<f:facet name="header">
									<h:outputText value="#{messages['commons.actions']}" />
								</f:facet>

								<p:tooltip for="editDiscountPlanItemLink"
									value="#{messages['commons.edit']}" showEffect="slide"
									hideEffect="slide" />
								<p:commandButton id="editDiscountPlanItemLink"
									update=":tabView:discountPlanItemPanel,:tabView:discountPlanItemFormPanel:formDiscountPlanItem"
									action="#{discountPlanBean.setDiscountPlanItem(entity)}"
									icon="ui-icon-document" />
								<p:tooltip for="deleteDiscountPlanItemLink"
									value="#{messages['commons.delete']}" showEffect="slide"
									hideEffect="slide" />
								<p:commandButton id="deleteDiscountPlanItemLink"
									action="#{discountPlanBean.deleteDiscountPlan(entity)}"
									icon="ui-icon-trash" ajax="true"
									update=":tabView:discountPlanItemPanel,:tabView:discountPlanItemFormPanel:formDiscountPlanItem" />
									 
							</p:column>
						</hftl:dataList>
						</p:panel>
						<p:panel>
						<hf:formPanel edit="#{edit}" id="discountPlanItemFormPanel"
							formId="formDiscountPlanItem"
							label="#{messages['discountPlanItem.title']}"
							backingBean="#{discountPlanBean}" entity="#{discountPlanItem}"
							showFormButtons="false">

							<div class="alert-box alert-box-notice">
								#{messages['message.discountPlanItem.info.requiredFields']}</div>

							<hf:formField label="#{messages['discountPlanMatrix.itemCode']}"
								field="code" required="true" />

							 <hf:formEntityField id="categorySelectId"
							label="#{messages['invoiceSubCategory.invoiceCategory']}"
							field="invoiceCategory" childField="code" required="false"
							popup="true" popupId="searchInvoiceCategoryPopup" /> 
							
							<hf:formEntityField id="invoiceSubCategorySelectedId"
							label="#{messages['charge.subCategory']}"
							field="invoiceSubCategory" childField="code" required="false"
							popup="true" popupId="searchInvoiceSubCategoryPopup" />	

							<hf:formField
								label="#{messages['discountPlanItem.accountingCode']}"
								field="accountingCode" />

							<hf:formField label="#{messages['discountPlanItem.percent']}"
								field="percent" required="true" minValue="-100" maxValue="100" />
								 
							<hf:formField label="#{messages['discountPlanItem.expressionEl']}"
							         field="expressionEl"  textArea="true" maxlength="2000"
									 edit="#{discountPlanBean.edit}"/> 
							<hf:formField label="#{messages['enableEntity.disabled']}"
							field="disabled" isMessage="true" />	
							<p:panelGrid columns="3">

								<p:commandButton id="saveButton"
									rendered="#{discountPlanItem.id==null}"
									value="#{messages['discountPlanItem.addNew']}"
									action="#{discountPlanBean.saveOrUpdateDiscountPlan()}"
									icon="ui-icon-check"
									update=":tabView:discountPlanItemPanel,:tabView:discountPlanItemFormPanel:formDiscountPlanItem"/>
								<p:commandButton
											rendered="#{discountPlanItem.id!=null}"
											action="#{discountPlanBean.saveOrUpdateDiscountPlan}"
											value="#{messages['discountPlanItem.modifyDiscountPlantItem']}"
											icon="ui-icon-check"
											update=":tabView:discountPlanItemPanel,:tabView:discountPlanItemFormPanel:formDiscountPlanItem"/>

								<hf:clearButton id="resetButton"
									label="#{messages['action.reset']}"
									edit="#{discountPlanBean.edit}"
									resetAction="#{discountPlanBean.resetFormEntity()}"
									includeViewParams="true" />

								<p:button id="backButton" value="#{messages['action.back']}"
									outcome="#{discountPlanBean.back()}" includeViewParams="true">
									<c:if
										test="#{conversation.id != null and not cc.attrs.killConversationOnBack}">
										<f:param name="cid"
											value="#{javax.enterprise.context.conversation.id}" />
									</c:if>
								</p:button>

							</p:panelGrid>

						</hf:formPanel>

					</p:panel>
				</p:tab>

			</p:tabView>

		</p:panel>

	</ui:define>

</ui:composition>
