<ui:composition xmlns="http://www.w3.org/1999/xhtml" xmlns:s="http://jboss.com/products/seam/taglib" xmlns:ui="http://java.sun.com/jsf/facelets"
    xmlns:f="http://java.sun.com/jsf/core" xmlns:h="http://java.sun.com/jsf/html" xmlns:hftl="http://hftl.org" xmlns:hf="http://java.sun.com/jsf/composite/tags"
    xmlns:p="http://primefaces.org/ui" template="/layout/template.xhtml" xmlns:of="http://omnifaces.org/functions">

    <f:metadata>
        <f:event type="preRenderView" listener="#{entityExportImportBean.preRenderView}" />
    </f:metadata>

    <ui:define name="navigation">
        <ui:include src="/layout/navigation.xhtml" />
    </ui:define>

    <ui:define name="body">
        <h:form id="searchForm" enctype="multipart/form-data">
            <p:panel id="searchPanel" styleClass="search-panel">
                <f:facet name="header">
                    <h:outputText value="#{messages['export.import']}" />
                </f:facet>
                <p:messages id="messages" autoUpdate="true" />
                <hftl:decorateFormField fieldId="import_requireFK" label="#{messages['export.requireFK']}" displayOneLine="true" labelWidth="60" componentWidth="20">
                    <p:selectBooleanCheckbox id="import_requireFK" value="#{entityExportImportBean.requireFK}">
                        <p:ajax event="change" />
                    </p:selectBooleanCheckbox>
                </hftl:decorateFormField>
                <hftl:decorateFormField fieldId="import_forceToProvider" label="#{messages['export.forceToProvider']}" displayOneLine="true" labelWidth="40">
                    <p:selectOneMenu id="import_forceToProvider" value="#{entityExportImportBean.forceToProvider}" converter="org.jboss.seam.faces.conversion.ObjectConverter">
                        <f:selectItem />
                        <f:selectItems value="#{identity.user.user.providers.toArray()}" var="listVal" itemLabel="#{listVal.code}" itemValue="#{listVal}" />
                        <p:ajax event="change" />
                    </p:selectOneMenu>
                </hftl:decorateFormField>
                <hftl:decorateFormField fieldId="import_file" label="#{messages['export.importFile']}" newLine="true" componentWidth="100" labelWidth="10" displayOneLine="true">
                    <p:fileUpload id="import_file" mode="advanced" fileUploadListener="#{entityExportImportBean.uploadImportFile}" allowTypes="/(\.|\/)(xml)$/" auto="false"
                        update=":importSummary" />
                </hftl:decorateFormField>
            </p:panel>
        </h:form>

        <h:panelGroup id="importSummary">
            <p:panel styleClass="search-panel" header="#{messages['export.importResults']}" rendered="#{entityExportImportBean.exportImportStats!=null}">
                <h:form id="form">
                    <p:dataTable id="datatable" var="stat" value="#{entityExportImportBean.exportImportStats.summary.entrySet().toArray()}" paginator="true" rows="20"
                        paginatorTemplate="{RowsPerPageDropdown} {FirstPageLink} {PreviousPageLink} {CurrentPageReport} {NextPageLink} {LastPageLink}"
                        rowsPerPageTemplate="20,30,50" lazy="false" styleClass="custom-grid" rowIndexVar="rowIndex" resizableColumns="true">
                        <p:column headerText="#{messages['export.entityClass']}" sortBy="#{stat.key}">
                            <h:outputText value="#{stat.key.name}" />
                        </p:column>
                        <p:column headerText="#{messages['export.numberImported']}">
                            <h:outputText value="#{stat.value}" />
                        </p:column>
                    </p:dataTable>
                </h:form>
            </p:panel>
            <p:panel styleClass="search-panel" header="#{messages['export.fieldsNotImported']}"
                rendered="#{entityExportImportBean.exportImportStats!=null and !entityExportImportBean.exportImportStats.fieldsNotImported.isEmpty()}">
                <h:form id="fiForm">
                    <p:dataTable id="fiDatatable" var="stat" value="#{entityExportImportBean.exportImportStats.fieldsNotImported.entrySet().toArray()}" paginator="true" rows="20"
                        paginatorTemplate="{RowsPerPageDropdown} {FirstPageLink} {PreviousPageLink} {CurrentPageReport} {NextPageLink} {LastPageLink}"
                        rowsPerPageTemplate="20,30,50" lazy="false" styleClass="custom-grid" rowIndexVar="rowIndex">
                        <p:column headerText="#{messages['export.exportTemplate']}" sortBy="#{stat.key}">
                            <h:outputText value="#{stat.key}" />
                        </p:column>
                        <p:column headerText="#{messages['export.fields']}">
                            <h:outputText value="#{of:joinCollection(stat.value, ',')}" />
                        </p:column>
                    </p:dataTable>
                </h:form>
            </p:panel>
        </h:panelGroup>
    </ui:define>

</ui:composition>