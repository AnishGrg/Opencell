<ui:composition xmlns="http://www.w3.org/1999/xhtml"
	xmlns:s="http://jboss.org/seam/faces"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:h="http://java.sun.com/jsf/html" xmlns:hftl="http://hftl.org"
	xmlns:hf="http://java.sun.com/jsf/composite/tags"
	xmlns:of="http://omnifaces.org/functions"
	xmlns:c="http://java.sun.com/jstl/core"
	xmlns:p="http://primefaces.org/ui" template="/layout/template.xhtml"
	xmlns:o="http://omnifaces.org/ui">

	<ui:define name="navigation">
		<ui:include src="/layout/navigation.xhtml" />
	</ui:define>

	<ui:define name="body">
		<hftl:entityPopup id="searchCustomEntity"
			header="#{messages['customEntity.popup.header']}"
			backingBean="#{customEntityTemplateListBean}"
			searchField1Label="#{messages['businessEntity.code']}"
			searchField1="code" column1Label="#{messages['businessEntity.code']}"
			column1="code"
			column2Label="#{messages['businessEntity.description']}"
			column2="description" selection="#{meveoModuleBean.customEntity}"
			updateField="moduleFormId:moduleItems">
		</hftl:entityPopup>
		<hftl:entityPopup id="searchCustomField"
			header="#{messages['customField.popup.header']}"
			backingBean="#{customFieldTemplateListBean}"
			searchField1Label="#{messages['businessEntity.code']}"
			searchField1="code"
			selection="#{meveoModuleBean.customField}"
			column1Label="#{messages['businessEntity.code']}"
			column1="code" column2Label="#{messages['businessEntity.description']}"
			column2="description" column3Label="#{messages['meveoModuleItem.appliesTo']}"
			column3="appliesTo" updateField="moduleFormId:moduleItems">
		</hftl:entityPopup>
		<hftl:entityPopup id="searchFilter"
			header="#{messages['filter.popup.header']}"
			backingBean="#{filterListBean}"
			searchField1Label="#{messages['businessEntity.code']}"
			searchField1="code" column1Label="#{messages['businessEntity.code']}"
			column1="code"
			column2Label="#{messages['businessEntity.description']}"
			column2="description" selection="#{meveoModuleBean.filter}"
			updateField="moduleFormId:moduleItems">
		</hftl:entityPopup>
		<hftl:entityPopup id="searchScript"
			header="#{messages['scriptInstance.popup.header']}"
			backingBean="#{scriptInstanceListBean}"
			searchField1Label="#{messages['businessEntity.code']}"
			searchField1="code" column1Label="#{messages['businessEntity.code']}"
			column1="code"
			column2Label="#{messages['businessEntity.description']}"
			column2="description" selection="#{meveoModuleBean.script}"
			updateField="moduleFormId:moduleItems">
		</hftl:entityPopup>
		<hftl:entityPopup id="searchJob"
			header="#{messages['jobInstance.popup.header']}"
			backingBean="#{jobInstanceListBean}"
			searchField1Label="#{messages['businessEntity.code']}"
			searchField1="code" column1Label="#{messages['businessEntity.code']}"
			column1="code"
			column2Label="#{messages['businessEntity.description']}"
			column2="description" selection="#{meveoModuleBean.job}"
			updateField="moduleFormId:moduleItems">
		</hftl:entityPopup>
		<hftl:entityPopup id="searchNotification"
			header="#{messages['notification.popup.header']}"
			backingBean="#{notificationListBean}"
			searchField1Label="#{messages['businessEntity.code']}"
			searchField1="code" column1Label="#{messages['businessEntity.code']}"
			column1="code"
			column2Label="#{messages['businessEntity.description']}"
			column2="description" selection="#{meveoModuleBean.notification}"
			updateField="moduleFormId:moduleItems">
		</hftl:entityPopup>
		<p:panel>
			<h:form id="crumbmenuForm">
				<p:breadCrumb homeDisplay="text" id="crumbmenu">
					<p:menuitem value="#{messages['menu.admin']}" disabled="true" />
					<p:menuitem outcome="meveoModules"
						value="#{messages['menu.meveoModules']}" />
				</p:breadCrumb>
			</h:form>
		</p:panel>
		<hftl:formPanel formId="moduleFormId" ajaxSubmit="true" buttons="true"
			label="#{messages['meveoModule.title']}" showEnableDisableButton="true"
			backingBean="#{meveoModuleBean}">
			<hftl:formField label="#{messages['businessEntity.code']}"
				field="code" maxlength="35" required="true" validateUnique="true"/>
			<hftl:formField label="#{messages['businessEntity.description']}"
				field="description" id="description" maxlength="100" />
			<hftl:formField label="#{messages['meveoModule.license']}" required="true"
				field="license" id="license" isMessage="true"/>
			<hftl:formField label="#{messages['enableEntity.disabled']}"
				doNotShowOnNew="true" allowEdit="false" field="disabled"
				isMessage="true" />
			<hftl:decorateFormField
				label="#{messages['meveoModule.items']}" 
				componentWidth="100" displayOneLine="false" newLine="true">
				<p:treeTable id="moduleItems" lazy="false"
					value="#{meveoModuleBean.root}" var="r" reflow="false"
					resizableColumns="true" rowIndexVar="rowIndex">
					<p:column headerText="#{messages['businessEntity.code']}">
						<h:outputText value="#{r.code}" styleClass="field-value" />
					</p:column>
					<p:column headerText="#{messages['businessEntity.description']}">
						<h:outputText value="#{r.description}" styleClass="field-value" />
					</p:column>
					<p:column headerText="#{messages['meveoModuleItem.appliesTo']}">
						<h:outputText value="#{r.appliesTo}" styleClass="field-value" />
					</p:column>
					<p:column headerText="#{messages['meveoModuleItemType.type']}">
						<h:outputText value="#{messages[r.type.label]}" styleClass="field-value" />
					</p:column>
					<p:column headerText="#{messages['commons.actions']}" width="15%">
						<p:commandButton icon="ui-icon-minus" partialSubmit="true"
							process="@this" update="moduleItems" rendered="#{not empty r.type}"
							action="#{meveoModuleBean.removeTreeNode(r)}" />
					</p:column>
					<f:facet name="footer" layout="block">
						<p:commandButton value="#{messages['meveoModuleItem.addCE']}"
							partialSubmit="true" process="@this"
							oncomplete="PF('dlg_searchCustomEntity').show()" />
						<p:commandButton value="#{messages['meveoModuleItem.addCF']}"
							partialSubmit="true" process="@this"
							oncomplete="PF('dlg_searchCustomField').show()" />
						<p:commandButton value="#{messages['meveoModuleItem.addFilter']}"
							partialSubmit="true" process="@this"
							oncomplete="PF('dlg_searchFilter').show()" />
						<p:commandButton value="#{messages['meveoModuleItem.addJob']}"
							partialSubmit="true" process="@this"
							oncomplete="PF('dlg_searchJob').show()" />
						<p:commandButton value="#{messages['meveoModuleItem.addScript']}"
							partialSubmit="true" process="@this"
							oncomplete="PF('dlg_searchScript').show()" />
						<p:commandButton value="#{messages['meveoModuleItem.addNotification']}"
							partialSubmit="true" process="@this"
							oncomplete="PF('dlg_searchNotification').show()" />
					</f:facet>
				</p:treeTable>
			</hftl:decorateFormField>
            <ui:param name="buttons" value="true" />
			<ui:define name="buttons">
				<p:commandButton id="exportModuleButton" update=":#{p:component('meveoModuleDialog')}"
					value="#{messages['meveoModule.exportModule']}" rendered="#{not empty meveoModuleBean.objectId}"
					oncomplete="PF('meveoModuleDialog').show()">
					<f:setPropertyActionListener value="#{null}" target="#{meveoModuleBean.meveoInstance}"/>
				</p:commandButton>
			</ui:define>
		</hftl:formPanel>
		<p:dialog id="meveoModuleDialog" styleClass="confirm-dialog"
			header="#{messages['meveoModule.exportModule']}"
			widgetVar="meveoModuleDialog" width="700" modal="true">
			<hftl:decorateFormPanel formId="module"
				rendered="#{not empty meveoModuleBean.entity}">
				<ui:define name="fields">
					<hftl:decorateFormField
						label="#{messages['meveoModule.meveoInstance']}">
						<p:selectOneMenu value="#{meveoModuleBean.meveoInstance}"
							id="meveoInstance" required="true">
							<f:selectItem />
							<f:selectItems value="#{meveoInstanceListBean.listAll()}"
								var="listVal" itemLabel="#{listVal.code}" itemValue="#{listVal}" />
							<s:objectConverter />
							<p:ajax event="valueChange" update="@form"/>
						</p:selectOneMenu>
					</hftl:decorateFormField>
				</ui:define>
				<ui:define name="buttons">
					<p:commandButton id="confirmOk" value="#{messages['commons.yes']}" partialSubmit="true"
						oncomplete="if (args &amp;&amp; !args.validationFailed) PF('meveoModuleDialog').hide()"
						process="@this meveoInstance" actionListener="#{meveoModuleBean.exportModule}"
						update=":module:messages :#{p:component('moduleFormId')}">
					</p:commandButton>
					<p:commandButton id="confirmKo" value="#{messages['commons.no']}"
						onclick="PF('meveoModuleDialog').hide()"
						type="button" />
				</ui:define>
			</hftl:decorateFormPanel>
		</p:dialog>
	</ui:define>

</ui:composition>
