<ui:composition xmlns="http://www.w3.org/1999/xhtml" xmlns:ui="http://java.sun.com/jsf/facelets" xmlns:f="http://java.sun.com/jsf/core" xmlns:h="http://java.sun.com/jsf/html"
    xmlns:hftl="http://hftl.org" xmlns:hf="http://java.sun.com/jsf/composite/tags" xmlns:p="http://primefaces.org/ui" xmlns:pe="http://primefaces.org/ui/extensions"
    template="/layout/template.xhtml">

    <ui:define name="metadata">
        <f:metadata>
            <f:viewParam name="entityClass" value="#{customEntityTemplateBean.entityClassName}" />
            <f:viewParam name="cetId" value="#{customEntityTemplateBean.objectIdFromSet}" />
        </f:metadata>
    </ui:define>


    <ui:define name="navigation">
        <ui:include src="/layout/navigation.xhtml" />
    </ui:define>

    <ui:define name="body">

        <h:panelGroup rendered="#{customEntityTemplateBean.customEntityTemplate}">
            <hftl:formPanel formId="cetForm"
                label="#{messages['customizedEntities.detail'].concat(customEntityTemplateBean.entity.code!=null?(' - '.concat(customEntityTemplateBean.entity.getCode)):'')}"
                backingBean="#{customEntityTemplateBean}">
                <hftl:formField label="#{messages['BusinessEntity.code']}" field="code" showOnlyOnNew="true" required="true" />
                <hftl:formField label="#{messages['customizedEntities.name']}" field="name" required="true" />
                <hftl:formField label="#{messages['BusinessEntity.description']}" field="description" />
            </hftl:formPanel>
        </h:panelGroup>
        <h:panelGroup rendered="#{! customEntityTemplateBean.customEntityTemplate}">
            <hftl:decorateFormPanel label="#{messages['customizedEntities.detail']} - #{customEntityTemplateBean.customizedEntity.entityName}">

            </hftl:decorateFormPanel>
        </h:panelGroup>

        <h:form id="fieldsForm">
            <p:panel width="100" header="#{messages['customizedEntities.fields']}" rendered="#{customEntityTemplateBean.cetPrefix!=null}">
                <p:treeTable id="fields" value="#{customEntityTemplateBean.fields}" var="entity" nodeVar="node">
                    <p:column headerText="#{messages['BusinessEntity.code']}">
                        <h:outputText value="#{entity.code}" rendered="#{node.type == 'field'}" />
                        <h:panelGroup styleClass="ui-icon ui-icon-folder-collapsed inlineIcon" rendered="#{node.type == 'tab'}" />
                        <h:panelGroup styleClass="ui-icon ui-icon-contact inlineIcon" rendered="#{node.type == 'fieldGroup'}" />
                        <h:outputText value="#{entity}" rendered="#{node.type == 'tab' or node.type == 'fieldGroup'}" />
                    </p:column>
                    <p:column headerText="#{messages['customFieldTemplate.fieldLabel']}">
                        <h:outputText value="#{entity.description}" rendered="#{node.type == 'field'}" />
                    </p:column>
                    <p:column headerText="#{messages['customFieldTemplate.fieldType']}">
                        <h:outputText value="#{messages[entity.fieldType.label]}" rendered="#{node.type == 'field'}" />
                    </p:column>
                    <p:column headerText="#{messages['customFieldTemplate.storageType']}">
                        <h:outputText value="#{messages[entity.storageType.label]}" rendered="#{node.type == 'field'}" />
                    </p:column>
                    <p:column headerText="#{messages['customFieldTemplate.fieldRequired']}">
                        <h:outputText value="#{messages['commons.yes']}"
                            rendered="#{node.type == 'field' and entity.valueRequired != null and entity.valueRequired.toString() == 'true'}" />
                        <h:outputText value="#{messages['commons.no']}"
                            rendered="#{node.type == 'field' and entity.valueRequired != null and entity.valueRequired.toString() == 'false'}" />
                    </p:column>
                    <p:column headerText="#{messages['customFieldTemplate.versionable']}">
                        <h:outputText value="#{messages['commons.yes']}"
                            rendered="#{node.type == 'field' and entity.versionable != null and entity.versionable.toString() == 'true'}" />
                        <h:outputText value="#{messages['commons.no']}"
                            rendered="#{node.type == 'field' and entity.versionable != null and entity.versionable.toString() == 'false'}" />
                    </p:column>
                    <p:column headerText="#{messages['enableEntity.active']}">
                        <h:outputText value="#{messages['commons.yes']}" rendered="#{node.type == 'field' and entity.active != null and entity.active.toString() == 'true'}" />
                        <h:outputText value="#{messages['commons.no']}" rendered="#{node.type == 'field' and entity.active != null and entity.active.toString() == 'false'}" />
                    </p:column>
                    <p:column headerText="#{messages['commons.actions']}" width="10%">
                        <h:panelGroup rendered="#{node.type == 'tab'}">
                            <p:tooltip for="editTabBtn" value="#{messages['commons.edit']}" showEffect="slide" hideEffect="slide" />
                            <p:commandButton id="editTabBtn" icon="ui-icon-document" oncomplete="PF('groupDialog').show()" update=":groupForm">
                                <f:setPropertyActionListener target="#{customEntityTemplateBean.selectedFieldGrouping}" value="#{node}" />
                            </p:commandButton>

                            <p:tooltip for="addFieldGroupBtn" value="#{messages['customizedEntities.addFieldGroup']}" showEffect="slide" hideEffect="slide" />
                            <p:commandButton id="addFieldGroupBtn" icon="ui-icon-contact" action="#{customEntityTemplateBean.newFieldGroup(node)}"
                                oncomplete="PF('groupDialog').show()" update=":groupForm" />

                            <p:tooltip for="addFieldInTabBtn" value="#{messages['customizedEntities.addField']}" showEffect="slide" hideEffect="slide" />
                            <p:commandButton id="addFieldInTabBtn" icon="ui-icon-plus" oncomplete="PF('cftDialog').show()" actionListener="#{customFieldTemplateBean.newEntity()}"
                                update=":cftForm">
                                <f:setPropertyActionListener target="#{customFieldTemplateBean.backViewSave}" value="customizedEntity" />
                                <f:setPropertyActionListener target="#{customFieldTemplateBean.entity.appliesTo}" value="#{customEntityTemplateBean.cetPrefix}" />
                                <f:setPropertyActionListener target="#{customFieldTemplateBean.entity.guiPosition}" value="#{node.guiPositionForField}" />
                            </p:commandButton>

                            <p:tooltip for="deleteTablink" value="#{messages['commons.delete']}" showEffect="slide" hideEffect="slide" />
                            <p:commandButton id="deleteTablink" icon="ui-icon-trash" oncomplete="PF('tabConfirmDeleteWidget').show()" rendered="#{node.parent.childCount &gt; 1}">
                                <f:setPropertyActionListener target="#{customEntityTemplateBean.selectedFieldGrouping}" value="#{node}" />
                            </p:commandButton>


                            <p:tooltip for="moveUpTabBtn" value="#{messages['action.moveUp']}" showEffect="slide" hideEffect="slide" />
                            <p:commandButton id="moveUpTabBtn" icon="ui-icon-arrowthick-1-n" action="#{customEntityTemplateBean.moveUp(node)}" update=":fieldsForm:fields"
                                rendered="#{node.canMoveUp}" />

                            <p:tooltip for="moveDownTabBtn" value="#{messages['action.moveDown']}" showEffect="slide" hideEffect="slide" />
                            <p:commandButton id="moveDownTabBtn" icon="ui-icon-arrowthick-1-s" action="#{customEntityTemplateBean.moveDown(node)}" update=":fieldsForm:fields"
                                rendered="#{node.canMoveDown}" />
                        </h:panelGroup>

                        <h:panelGroup rendered="#{node.type == 'fieldGroup'}">
                            <p:tooltip for="editFieldGroupBtn" value="#{messages['commons.edit']}" showEffect="slide" hideEffect="slide" />
                            <p:commandButton id="editFieldGroupBtn" icon="ui-icon-document" oncomplete="PF('groupDialog').show()" update=":groupForm">
                                <f:setPropertyActionListener target="#{customEntityTemplateBean.selectedFieldGrouping}" value="#{node}" />
                            </p:commandButton>

                            <p:tooltip for="addFieldInFieldGroupBtn" value="#{messages['customizedEntities.addField']}" showEffect="slide" hideEffect="slide" />
                            <p:commandButton id="addFieldInFieldGroupBtn" icon="ui-icon-plus" oncomplete="PF('cftDialog').show()"
                                actionListener="#{customFieldTemplateBean.newEntity()}" update=":cftForm">
                                <f:setPropertyActionListener target="#{customFieldTemplateBean.backViewSave}" value="customizedEntity" />
                                <f:setPropertyActionListener target="#{customFieldTemplateBean.entity.appliesTo}" value="#{customEntityTemplateBean.cetPrefix}" />
                                <f:setPropertyActionListener target="#{customFieldTemplateBean.entity.guiPosition}" value="#{node.guiPositionForField}" />
                            </p:commandButton>

                            <p:tooltip for="deleteFieldGrouplink" value="#{messages['commons.delete']}" showEffect="slide" hideEffect="slide" />
                            <p:commandButton id="deleteFieldGrouplink" icon="ui-icon-trash" oncomplete="PF('fieldGroupConfirmDeleteWidget').show()">
                                <f:setPropertyActionListener target="#{customEntityTemplateBean.selectedFieldGrouping}" value="#{node}" />
                            </p:commandButton>

                            <p:tooltip for="moveUpFgBtn" value="#{messages['action.moveUp']}" showEffect="slide" hideEffect="slide" />
                            <p:commandButton id="moveUpFgBtn" icon="ui-icon-arrowthick-1-n" action="#{customEntityTemplateBean.moveUp(node)}" update=":fieldsForm:fields"
                                rendered="#{node.canMoveUp}" />

                            <p:tooltip for="moveDownFgBtn" value="#{messages['action.moveDown']}" showEffect="slide" hideEffect="slide" />
                            <p:commandButton id="moveDownFgBtn" icon="ui-icon-arrowthick-1-s" action="#{customEntityTemplateBean.moveDown(node)}" update=":fieldsForm:fields"
                                rendered="#{node.canMoveDown}" />
                        </h:panelGroup>

                        <h:panelGroup rendered="#{node.type == 'field'}">

                            <p:tooltip for="editFieldBtn" value="#{messages['commons.edit']}" showEffect="slide" hideEffect="slide" />
                            <p:commandButton id="editFieldBtn" icon="ui-icon-document" oncomplete="PF('cftDialog').show()" action="#{customFieldTemplateBean.initEntity(entity.id)}"
                                update=":cftForm">
                                <f:setPropertyActionListener target="#{customFieldTemplateBean.backViewSave}" value="customizedEntity" />
                            </p:commandButton>


                            <p:commandButton id="enablelink" icon="ui-icon-circle-check" rendered="#{entity.disabled}" oncomplete="PF('confirmEnableWidget').show()">
                                <f:setPropertyActionListener target="#{customFieldTemplateBean.entity}" value="#{entity}" />
                            </p:commandButton>
                            <p:commandButton id="disablelink" icon="ui-icon-circle-close" rendered="#{not entity.disabled}" oncomplete="PF('confirmDisableWidget').show()">
                                <f:setPropertyActionListener target="#{customFieldTemplateBean.entity}" value="#{entity}" />
                            </p:commandButton>

                            <p:tooltip for="enablelink" value="#{messages['commons.enable']}" showEffect="slide" hideEffect="slide" />

                            <p:tooltip for="disablelink" value="#{messages['commons.disable']}" showEffect="slide" hideEffect="slide" />



                            <p:remoteCommand id="remoteDeleteButton" actionListener="#{customFieldTemplateBean.deleteInlist}" action="#{customEntityTemplateBean.refreshFields}"
                                name="fieldsDoDelete" oncomplete="handleDeleteComplete(xhr,status,args)" update="@form" />
                            <p:tooltip for="deletelink" value="#{messages['commons.delete']}" showEffect="slide" hideEffect="slide" />
                            <p:commandButton id="deletelink" icon="ui-icon-trash" oncomplete="PF('confirmDeleteFieldsWidget').show()">
                                <f:setPropertyActionListener target="#{customFieldTemplateBean.entity}" value="#{entity}"></f:setPropertyActionListener>
                            </p:commandButton>


                            <p:tooltip for="moveUpFBtn" value="#{messages['action.moveUp']}" showEffect="slide" hideEffect="slide" />
                            <p:commandButton id="moveUpFBtn" icon="ui-icon-arrowthick-1-n" action="#{customEntityTemplateBean.moveUp(node)}" update=":fieldsForm:fields"
                                rendered="#{node.canMoveUp}" />

                            <p:tooltip for="moveDownFBtn" value="#{messages['action.moveDown']}" showEffect="slide" hideEffect="slide" />
                            <p:commandButton id="moveDownFBtn" icon="ui-icon-arrowthick-1-s" action="#{customEntityTemplateBean.moveDown(node)}" update=":fieldsForm:fields"
                                rendered="#{node.canMoveDown}" />

                        </h:panelGroup>
                    </p:column>
                    <f:facet name="footer">
                        <p:commandButton id="addTab" value="#{messages['customizedEntities.addNewTab']}" oncomplete="PF('groupDialog').show()"
                            actionListener="#{customEntityTemplateBean.newTab()}" update=":groupForm">
                        </p:commandButton>
                        <!--                         <p:commandButton id="addlink" value="#{messages['customizedEntities.addNewField']}" oncomplete="PF('cftDialog').show()" -->
                        <!--                             actionListener="#{customFieldTemplateBean.newEntity()}" update=":cftForm"> -->
                        <!--                             <f:setPropertyActionListener target="#{customFieldTemplateBean.backViewSave}" value="customizedEntity" /> -->
                        <!--                             <f:setPropertyActionListener target="#{customFieldTemplateBean.entity.appliesTo}" value="#{customEntityTemplateBean.cetPrefix}" /> -->
                        <!--                         </p:commandButton> -->
                    </f:facet>
                </p:treeTable>
            </p:panel>

            <p:panel width="100" header="#{messages['customizedEntities.actions']}" rendered="#{customEntityTemplateBean.cetPrefix!=null}">
                <p:dataTable id="entityActions" var="entity" value="#{customEntityTemplateBean.entityActions}" paginator="true" rows="10" sortBy="#{entity.code}"
                    paginatorAlwaysVisible="false" paginatorTemplate="{RowsPerPageDropdown} {FirstPageLink} {PreviousPageLink} {CurrentPageReport} {NextPageLink} {LastPageLink}"
                    rowsPerPageTemplate="10" lazy="false" styleClass="custom-grid" reflow="true">
                    <p:column headerText="#{messages['BusinessEntity.code']}">
                        <h:outputText value="#{entity.localCodeForRead}" />
                    </p:column>
                    <p:column headerText="#{messages['customizedEntities.actionLabel']}">
                        <h:outputText value="#{entity.label}" />
                    </p:column>
                    <p:column headerText="#{messages['BusinessEntity.description']}">
                        <h:outputText value="#{entity.description}" />
                    </p:column>
                    <p:column headerText="#{messages['customizedEntities.actionApplicableOnEl.short']}">
                        <h:outputText value="#{entity.applicableOnEl}" />
                    </p:column>
                    <hftl:column label="#{messages['scriptInstance.error']}" field="error" isMessage="true" width="15%" />
                    <p:column headerText="#{messages['enableEntity.active']}" width="10%">
                        <h:outputText value="#{messages['commons.yes']}" rendered="#{entity.active != null and entity.active.toString() == 'true'}" />
                        <h:outputText value="#{messages['commons.no']}" rendered="#{entity.active != null and entity.active.toString() == 'false'}" />
                    </p:column>

                    <p:column headerText="#{messages['commons.actions']}" width="10%">
                        <p:tooltip for="editActionBtn" value="#{messages['commons.edit']}" showEffect="slide" hideEffect="slide" />
                        <p:commandButton id="editActionBtn" icon="ui-icon-document" oncomplete="PF('actionDialog').show()" action="#{entityActionScriptBean.initEntity(entity.id)}"
                            update=":actionForm">
                            <f:setPropertyActionListener target="#{entityActionScriptBean.backViewSave}" value="customizedEntity" />
                        </p:commandButton>

                        <p:commandButton id="enableActionlink" icon="ui-icon-circle-check" rendered="#{entity.disabled}" oncomplete="PF('confirmEnableActionWidget').show()">
                            <f:setPropertyActionListener target="#{entityActionScriptBean.entity}" value="#{entity}" />
                        </p:commandButton>
                        <p:commandButton id="disableActionlink" icon="ui-icon-circle-close" rendered="#{not entity.disabled}" oncomplete="PF('confirmDisableActionWidget').show()">
                            <f:setPropertyActionListener target="#{entityActionScriptBean.entity}" value="#{entity}" />
                        </p:commandButton>

                        <p:tooltip for="enableActionlink" value="#{messages['commons.enable']}" showEffect="slide" hideEffect="slide" />
                        <p:tooltip for="disableActionlink" value="#{messages['commons.disable']}" showEffect="slide" hideEffect="slide" />

                        <p:tooltip for="deleteActionlink" value="#{messages['commons.delete']}" showEffect="slide" hideEffect="slide" />
                        <p:commandButton id="deleteActionlink" icon="ui-icon-trash" oncomplete="PF('confirmDeleteActionsWidget').show()">
                            <f:setPropertyActionListener target="#{entityActionScriptBean.entity}" value="#{entity}" />
                        </p:commandButton>

                    </p:column>

                    <f:facet name="footer">
                        <p:commandButton id="addAction" value="#{messages['customizedEntities.addAction']}" oncomplete="PF('actionDialog').show()"
                            actionListener="#{entityActionScriptBean.newEntity()}" update=":actionForm">
                            <f:setPropertyActionListener target="#{entityActionScriptBean.backViewSave}" value="customizedEntity" />
                            <f:setPropertyActionListener target="#{entityActionScriptBean.entity.appliesTo}" value="#{customEntityTemplateBean.cetPrefix}" />
                        </p:commandButton>
                    </f:facet>

                </p:dataTable>


                <p:button id="backButton" value="#{messages['action.back']}" outcome="#{customEntityTemplateBean.back()}" includeViewParams="true">
                    <f:param name="cid" value="#{javax.enterprise.context.conversation.id}" />
                </p:button>

                <!--  Field related confirmation widgets -->
                <p:confirmDialog id="confirmDeleteTabDialog" styleClass="confirm-dialog" message="#{messages['customizedEntities.confirmDeleteTab']}" header="" severity="alert"
                    widgetVar="tabConfirmDeleteWidget" appendTo="@(body)">
                    <p:panel styleClass="confirm-dialog-content">
                        <p:commandButton id="confirmDeleteTabOk" value="#{messages['commons.yes']}" action="#{customEntityTemplateBean.removeFieldGrouping()}"
                            update=":fieldsForm:fields" onclick="PF('tabConfirmDeleteWidget').hide()" process="@this" />
                        <p:commandButton value="#{messages['commons.no']}" onclick="PF('tabConfirmDeleteWidget').hide()" type="button" />
                    </p:panel>
                </p:confirmDialog>


                <p:confirmDialog id="confirmDeleteFieldGroupDialog" styleClass="confirm-dialog" message="#{messages['customizedEntities.confirmDeleteFieldGroup']}" header=""
                    severity="alert" widgetVar="fieldGroupConfirmDeleteWidget" appendTo="@(body)">
                    <p:panel styleClass="confirm-dialog-content">
                        <p:commandButton id="confirmDeleteFieldGroupOk" value="#{messages['commons.yes']}" action="#{customEntityTemplateBean.removeFieldGrouping()}"
                            update=":fieldsForm:fields" onclick="PF('fieldGroupConfirmDeleteWidget').hide()" process="@this" />
                        <p:commandButton value="#{messages['commons.no']}" onclick="PF('fieldGroupConfirmDeleteWidget').hide()" type="button" />
                    </p:panel>
                </p:confirmDialog>

                <p:confirmDialog id="confirmEnableDialog" styleClass="confirm-dialog" message="#{messages['commons.confirmEnable']}" header="#{messages['commons.enable']}"
                    severity="alert" widgetVar="confirmEnableWidget" appendTo="@(body)">
                    <p:panel styleClass="confirm-dialog-content">
                        <p:commandButton id="enableOk" value="#{messages['commons.yes']}" oncomplete="PF('confirmEnableWidget').hide()" process="@this"
                            actionListener="#{customEntityTemplateBean.refreshFields}" action="#{customFieldTemplateBean.enable()}" update="@form" />
                        <p:commandButton id="enableKo" value="#{messages['commons.no']}" onclick="PF('confirmEnableWidget').hide()" type="button" />
                    </p:panel>
                </p:confirmDialog>
                <p:confirmDialog id="confirmDisableDialog" styleClass="confirm-dialog" message="#{messages['commons.confirmDisable']}" header="#{messages['commons.disable']}"
                    severity="alert" widgetVar="confirmDisableWidget" appendTo="@(body)">
                    <p:panel styleClass="confirm-dialog-content">
                        <p:commandButton id="disableOk" value="#{messages['commons.yes']}" oncomplete="PF('confirmEnableWidget').hide()" process="@this"
                            actionListener="#{customEntityTemplateBean.refreshFields}" action="#{customFieldTemplateBean.disable()}" update="@form" />
                        <p:commandButton id="disableKo" value="#{messages['commons.no']}" onclick="PF('confirmDisableWidget').hide()" type="button" />
                    </p:panel>
                </p:confirmDialog>

                <p:confirmDialog id="confirmDeleteDialog" styleClass="confirm-dialog" message="#{messages['commons.confirmDelete']}" header="" severity="alert"
                    widgetVar="confirmDeleteFieldsWidget" appendTo="@(body)">
                    <p:panel styleClass="confirm-dialog-content">
                        <p:commandButton id="deleteOk" value="#{messages['commons.yes']}" oncomplete="fieldsDoDelete()" onclick="PF('confirmDeleteFieldsWidget').hide()" />
                        <p:commandButton id="deleteKo" value="#{messages['commons.no']}" onclick="PF('confirmDeleteFieldsWidget').hide()" type="button" />
                    </p:panel>
                </p:confirmDialog>
                <p:confirmDialog id="confirmCanDeleteDialog" styleClass="confirm-dialog" message="#{messages['commons.confirmCanotDelete']}" header="" severity="alert"
                    widgetVar="fieldsConfirmCanotDeleteWidget" appendTo="@(body)">
                    <p:panel styleClass="confirm-dialog-content">
                        <p:commandButton id="canotdeleteOk" value="#{messages['commons.ok']}" oncomplete="PF('fieldsConfirmCanotDeleteWidget').hide()" update="@this" />
                    </p:panel>
                </p:confirmDialog>



                <!-- Action related widgets -->
                <p:confirmDialog id="confirmEnableActionDialog" styleClass="confirm-dialog" message="#{messages['commons.confirmEnable']}" header="#{messages['commons.enable']}"
                    severity="alert" widgetVar="confirmEnableActionWidget" appendTo="@(body)">
                    <p:panel styleClass="confirm-dialog-content">
                        <p:commandButton value="#{messages['commons.yes']}" oncomplete="PF('confirmEnableActionWidget').hide()" process="@this"
                            actionListener="#{customEntityTemplateBean.refreshActions}" action="#{entityActionScriptBean.enable()}" update="@form" />
                        <p:commandButton value="#{messages['commons.no']}" onclick="PF('confirmEnableActionWidget').hide()" type="button" />
                    </p:panel>
                </p:confirmDialog>
                <p:confirmDialog id="confirmDisableActionDialog" styleClass="confirm-dialog" message="#{messages['commons.confirmDisable']}" header="#{messages['commons.disable']}"
                    severity="alert" widgetVar="confirmDisableActionWidget" appendTo="@(body)">
                    <p:panel styleClass="confirm-dialog-content">
                        <p:commandButton value="#{messages['commons.yes']}" oncomplete="PF('confirmEnableActionWidget').hide()" process="@this"
                            actionListener="#{customEntityTemplateBean.refreshActions}" action="#{entityActionScriptBean.disable()}" update="@form" />
                        <p:commandButton value="#{messages['commons.no']}" onclick="PF('confirmDisableActionWidget').hide()" type="button" />
                    </p:panel>
                </p:confirmDialog>

                <p:remoteCommand id="remoteDeleteActionButton" actionListener="#{entityActionScriptBean.deleteInlist}" action="#{customEntityTemplateBean.refreshActions}"
                    name="actionsDoDelete" oncomplete="handleDeleteComplete(xhr,status,args)" update="@form" />

                <p:confirmDialog id="confirmDeleteActionsDialog" styleClass="confirm-dialog" message="#{messages['commons.confirmDelete']}" header="" severity="alert"
                    widgetVar="confirmDeleteActionsWidget" appendTo="@(body)">
                    <p:panel styleClass="confirm-dialog-content">
                        <p:commandButton value="#{messages['commons.yes']}" oncomplete="actionsDoDelete()" onclick="PF('confirmDeleteActionsWidget').hide()" />
                        <p:commandButton value="#{messages['commons.no']}" onclick="PF('confirmDeleteActionsWidget').hide()" type="button" />
                    </p:panel>
                </p:confirmDialog>



                <script type="text/javascript">
																	//<![CDATA[
																	function handleDeleteComplete(
																			xhr,
																			status,
																			args) {
																		var result = args.result;
																		if (typeof (result) != "undefined"
																				&& !result) {
																			PF(
																					'fieldsConfirmCanotDeleteWidget')
																					.show();
																		}
																	}
																	//]]>
																</script>



            </p:panel>
        </h:form>

        <p:dialog id="groupDialog" header="#{messages['customizedEntities.groupDialogHeader']}" modal="true" closeOnEscape="false" widgetVar="groupDialog" width="50%"
            closable="false">

            <hftl:decorateFormPanel formId="groupForm" label="#{messages['customizedEntities.'.concat(customEntityTemplateBean.selectedFieldGrouping.type).concat('DialogHeader')]}">
                <ui:define name="fields">
                    <hftl:decorateFormField fieldId="parentName" label="#{messages['customizedEntities.parentTabTitle']}"
                        rendered="#{customEntityTemplateBean.selectedFieldGrouping.parent!=null and customEntityTemplateBean.selectedFieldGrouping.parent.type!='root'}">
                        <h:outputText id="parentName" value="#{customEntityTemplateBean.selectedFieldGrouping.parent.data}" />
                    </hftl:decorateFormField>

                    <hftl:decorateFormField fieldId="name" label="#{messages['customizedEntities.title']}">
                        <p:inputText id="name" value="#{customEntityTemplateBean.selectedFieldGrouping.data}" required="true" />
                    </hftl:decorateFormField>
                </ui:define>
                <ui:define name="buttons">
                    <p:commandButton value="#{messages['action.save']}" action="#{customEntityTemplateBean.saveUpdateFieldGrouping}" update="@form :fieldsForm:fields"
                        oncomplete="PF('groupDialog').hide()" />
                    <p:commandButton value="#{messages['action.cancel']}" action="#{customEntityTemplateBean.cancelFieldGrouping}" oncomplete="PF('groupDialog').hide()" />
                </ui:define>
            </hftl:decorateFormPanel>
        </p:dialog>


        <p:dialog id="cftDialog" header="#{messages['customFieldTemplate.panel']}" modal="true" closeOnEscape="true" maximizable="true" widgetVar="cftDialog" width="90%">

            <p:scrollPanel mode="native" style="max-height:600px">

                <hftl:formPanel formId="cftForm" label="#{messages['customFieldTemplate.panel']}" backingBean="#{customFieldTemplateBean}" showFormButtons="false">

                    <hftl:formField label="#{messages['BusinessEntity.code']}" field="code" required="true" allowEdit="false" componentWidth="15" />
                    <hftl:formField label="#{messages['customFieldTemplate.fieldLabel']}" field="description" required="true" useConverter="false" id="description" maxlength="50"
                        componentWidth="35" />
                    <hftl:formField label="#{messages['customFieldTemplate.fieldType']}" field="fieldType" required="true" componentWidth="10"
                        listenerUpdate=":cftForm:listValuesField :cftForm:defaultValueField :cftForm:entityClazzField validations" />
                    <!--                 <hftl:formField label="#{messages['customFieldTemplate.appliesTo']}" field="appliesTo" componentWidth="20" edit="false" /> -->
                    <!--                 <hftl:formField label="#{messages['customFieldTemplate.guipos']}" field="guiPosition" componentWidth="20" edit="false" /> -->
                    <hftl:formField label="#{messages['customFieldTemplate.storageType']}" field="storageType" listenerUpdate=":cftForm:defaultValueField :cftForm:mapKeyTypeField"
                        required="true" componentWidth="10" />

                    <h:panelGroup id="mapKeyTypeField">
                        <hftl:formField label="#{messages['customFieldTemplate.mapKeyType']}" field="mapKeyType" required="true" componentWidth="10"
                            rendered="#{customFieldTemplateBean.entity.storageType == 'MAP' or customFieldTemplateBean.entity.storageType == 'MATRIX'}" />
                    </h:panelGroup>
                    <h:panelGroup id="defaultValueField">
                        <hftl:formField label="#{messages['customFieldTemplate.defaultValue']}" field="defaultValue" maxlength="50" componentWidth="20"
                            rendered="#{customFieldTemplateBean.entity.fieldType != 'DATE' and customFieldTemplateBean.entity.fieldType != 'ENTITY' and customFieldTemplateBean.entity.storageType == 'SINGLE'}"
                            newLine="true" />
                    </h:panelGroup>
                    <h:panelGroup id="entityClazzField">
                        <hftl:formField label="#{messages['entity.notification.classNameFilter']}" field="entityClazz" required="true" size="60" maxlength="255"
                            autocompleteBean="#{customFieldTemplateBean}" autocompleteMethod="autocompleteClassNames" isAutocomplete="true" newLine="true"
                            rendered="#{customFieldTemplateBean.entity.fieldType == 'ENTITY'}" />
                    </h:panelGroup>
                    <p:fieldset id="validations" legend="#{messages['customFieldTemplate.validations']}" styleClass="clearLeft">
                        <hftl:formField label="#{messages['customFieldTemplate.fieldRequired']}" field="valueRequired" isMessage="true" componentWidth="10" />
                        <hftl:formField label="#{messages['customFieldTemplate.hideOnNew']}" field="hideOnNew" isMessage="true" componentWidth="10" />
                        <hftl:formField label="#{messages['customFieldTemplate.allowEdit']}" field="allowEdit" isMessage="true" componentWidth="10" />
                        <hftl:formField label="#{messages['customFieldTemplate.applicableOnEl']}" field="applicableOnEl" componentWidth="30" size="50" maxLength="150" />
                        <hftl:formField label="#{messages['customFieldTemplate.minValue']}" field="minValue" negativeValue="true" componentWidth="15"
                            rendered="#{customFieldTemplateBean.entity.fieldType == 'LONG' or customFieldTemplateBean.entity.fieldType == 'DOUBLE'}" />
                        <hftl:formField label="#{messages[customFieldTemplateBean.entity.fieldType == 'STRING'?'customFieldTemplate.maxValueTxt':'customFieldTemplate.maxValue']}"
                            field="maxValue" required="#{customFieldTemplateBean.entity.fieldType == 'STRING'}"
                            negativeValue="#{customFieldTemplateBean.entity.fieldType != 'STRING'}"
                            rendered="#{customFieldTemplateBean.entity.fieldType == 'LONG' or customFieldTemplateBean.entity.fieldType == 'DOUBLE' or customFieldTemplateBean.entity.fieldType == 'STRING'}"
                            componentWidth="15" />
                        <hftl:formField label="#{messages['customFieldTemplate.regExp']}" field="regExp" rendered="#{customFieldTemplateBean.entity.fieldType == 'STRING'}"
                            componentWidth="15" />
                    </p:fieldset>
                    <p:fieldset legend="#{messages['customFieldTemplate.versioningAndCaching']}" styleClass="clearLeft">
                        <hftl:formField label="#{messages['customFieldTemplate.cacheValue']}" field="cacheValue" isMessage="true" componentWidth="15" />
                        <hftl:formField label="#{messages['customFieldTemplate.versionable']}" field="versionable" isMessage="true" allowEdit="true" componentWidth="15"
                            listenerUpdate=":cftForm:versionableFields" />
                        <h:panelGroup id="versionableFields">
                            <hftl:formField label="#{messages['customFieldTemplate.calendar']}" field="calendar" valueLabelField="code" listBean="#{calendarBean}"
                                rendered="#{customFieldTemplateBean.entity.versionable}" />
                            <hftl:formField label="#{messages['customFieldTemplate.cacheTimeperiod']}" field="cacheValueTimeperiod"
                                rendered="#{customFieldTemplateBean.entity.versionable}" />
                            <hftl:formField label="#{messages['customFieldTemplate.triggerEndPeriodEvent']}" field="triggerEndPeriodEvent"
                                rendered="#{customFieldTemplateBean.entity.versionable}" componentWidth="15" />
                        </h:panelGroup>
                    </p:fieldset>
                    <h:panelGroup id="listValuesField">
                        <p:fieldset legend="#{messages['customFieldTemplate.listValues']}" styleClass="clearLeft" rendered="#{customFieldTemplateBean.entity.fieldType == 'LIST'}">
                            <hftl:formField label="#{messages['customFieldTemplate.listValues']}" field="listValues" mapKeyLabel="#{messages['commons.value']}"
                                mapValueLabel="#{messages['commons.label']}" componentWidth="75" newLine="true" />
                        </p:fieldset>
                    </h:panelGroup>
                    <hftl:formField label="#{messages['enableEntity.disabled']}" doNotShowOnNew="true" allowEdit="false" field="disabled" isMessage="true" newLine="true" />
                    <ui:param name="buttons" value="true" />
                    <ui:define name="buttons">
                        <hf:formButtons backingBean="#{customFieldTemplateBean}" showBackButton="false" ajaxSubmit="true" submitUpdate="@form :fieldsForm:fields" edit="true"
                            killConversationOnSave="false">
                            <p:commandButton value="#{messages['commons.disable']}"
                                rendered="#{not empty customFieldTemplateBean.entity.id and customFieldTemplateBean.entity.active}"
                                actionListener="#{customEntityTemplateBean.refreshFields}" action="#{customFieldTemplateBean.disable}" update="@form :fieldsForm:fields" />

                            <p:commandButton value="#{messages['commons.enable']}"
                                rendered="#{not empty customFieldTemplateBean.entity.id and customFieldTemplateBean.entity.disabled}"
                                actionListener="#{customEntityTemplateBean.refreshFields}" action="#{customFieldTemplateBean.enable}" update="@form :fieldsForm:fields" />

                            <p:commandButton value="#{messages['commons.close']}" onclick="PF('cftDialog').hide()" type="button" />
                        </hf:formButtons>

                    </ui:define>
                </hftl:formPanel>
            </p:scrollPanel>
        </p:dialog>



        <p:dialog id="actionDialog" header="#{messages['customizedEntities.actionHeader']}" modal="true" closeOnEscape="true" maximizable="true" widgetVar="actionDialog"
            width="90%" height="550px">

            <p:scrollPanel mode="native" style="max-height:550px">

                <hftl:formPanel formId="actionForm" label="#{messages['customizedEntities.actionHeader']}" backingBean="#{entityActionScriptBean}" showFormButtons="false">

                    <h:panelGroup rendered="#{entityActionScriptBean.entity.isError()}">
                        <div class="ui-messages ui-widget">
                            <div class="ui-messages-error ui-corner-all">
                                <span class="ui-messages-error-icon"></span>
                                <ul>
                                    <li><h:outputText value="#{messages['scriptInstance.compilationFailed']}" styleClass="ui-messages-error-summary" /></li>
                                </ul>
                            </div>
                        </div>
                    </h:panelGroup>

                    <hftl:formField label="#{messages['BusinessEntity.code']}" field="localCode" required="true" allowEdit="false" componentWidth="15" />
                    <hftl:formField label="#{messages['customizedEntities.actionLabel']}" field="label" required="true" useConverter="false" maxlength="50" componentWidth="20" />
                    <hftl:formField label="#{messages['BusinessEntity.description']}" field="description" useConverter="false" maxlength="50" componentWidth="35" />
                    <hftl:formField label="#{messages['customizedEntities.actionApplicableOnEl']}" field="applicableOnEl" componentWidth="30" size="50" maxLength="150" />
                    <hftl:formField label="#{messages['scriptInstance.sourceTypeEnum']}" field="sourceTypeEnum" />
                    <hftl:decorateFormField fieldId="codeMirror" label="#{messages['customizedEntities.actionScriptSrc']}" newLine="true" componentWidth="100">
                        <pe:codeMirror id="codeMirror" theme="eclipse" mode="text/x-java" value="#{entityActionScriptBean.entity.script}" lineNumbers="true" required="true" />
                    </hftl:decorateFormField>
                    <hftl:formField label="#{messages['enableEntity.disabled']}" doNotShowOnNew="true" allowEdit="false" field="disabled" isMessage="true" newLine="true" />

                    <h:panelGroup id="scriptErrors">
                        <hftl:decorateFormField label="#{messages['scriptInstance.compilationErrors']}" componentWidth="100" newLine="true"
                            rendered="#{entityActionScriptBean.entity.isError()}">
                            <p:dataTable id="entityActions" var="entity" value="#{entityActionScriptBean.entity.scriptErrors}" paginator="true" rows="10"
                                sortBy="#{entity.lineNumber}" sortField="lineNumber" paginatorAlwaysVisible="false"
                                paginatorTemplate="{RowsPerPageDropdown} {FirstPageLink} {PreviousPageLink} {CurrentPageReport} {NextPageLink} {LastPageLink}"
                                rowsPerPageTemplate="10" lazy="false" styleClass="custom-grid" reflow="true">
                                <hftl:column label="#{messages['scriptInstance.compilation.lineNumber']}" field="lineNumber" width="10%" />
                                <hftl:column label="#{messages['scriptInstance.compilation.columnNumber']}" field="columnNumber" width="15%" />
                                <hftl:column label="#{messages['scriptInstance.compilation.message']}" field="message" />
                            </p:dataTable>
                        </hftl:decorateFormField>
                    </h:panelGroup>
                    <ui:param name="buttons" value="true" />
                    <ui:define name="buttons">
                        <hf:formButtons backingBean="#{entityActionScriptBean}" showBackButton="false" ajaxSubmit="true" submitUpdate="@form :fieldsForm:entityActions" edit="true"
                            killConversationOnSave="false">
                            <p:commandButton value="#{messages['scriptInstance.testCompilation']}" action="#{entityActionScriptBean.testCompilation}" update="@form" />
                            <p:commandButton value="#{messages['commons.disable']}"
                                rendered="#{not empty entityActionScriptBean.entity.id and entityActionScriptBean.entity.active}"
                                actionListener="#{customEntityTemplateBean.refreshActions}" action="#{entityActionScriptBean.disable}" update="@form :fieldsForm:entityActions" />

                            <p:commandButton value="#{messages['commons.enable']}"
                                rendered="#{not empty entityActionScriptBean.entity.id and entityActionScriptBean.entity.disabled}"
                                actionListener="#{customEntityTemplateBean.refreshActions}" action="#{entityActionScriptBean.enable}" update="@form :fieldsForm:entityActions" />

                            <p:commandButton value="#{messages['commons.close']}" onclick="PF('actionDialog').hide()" type="button" />
                        </hf:formButtons>
                    </ui:define>
                </hftl:formPanel>
            </p:scrollPanel>
        </p:dialog>


    </ui:define>

</ui:composition>
