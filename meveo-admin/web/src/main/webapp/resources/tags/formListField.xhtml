<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml" xmlns:ui="http://java.sun.com/jsf/facelets" xmlns:h="http://java.sun.com/jsf/html" xmlns:f="http://java.sun.com/jsf/core"
    xmlns:p="http://primefaces.org/ui" xmlns:c="http://java.sun.com/jsp/jstl/core" xmlns:cc="http://java.sun.com/jsf/composite" xmlns:s="http://jboss.org/seam/faces"
    xmlns:hftl="http://hftl.org">

<cc:interface>

    <cc:attribute name="fieldItem" required="true" />
    <cc:attribute name="edit" default="true" />

</cc:interface>

<cc:implementation>

    <hftl:decorateFormField fieldId="#{cc.parent.attrs.fieldIdPrefix}_list#{cc.attrs.edit?'':'_view'}" label="#{cc.parent.attrs.label}"
        componentWidth="#{cc.parent.attrs.componentWidth}" newLine="#{cc.parent.attrs.newLine}" displayOneLine="#{cc.parent.attrs.displayOneLine}"
        styleClass="#{cc.parent.attrs.styleClass}" style="#{cc.parent.attrs.style}" labelStyle="#{cc.parent.attrs.labelStyle}" labelStyleClass="#{cc.parent.attrs.labelStyleClass}"
        inputStyle="#{cc.parent.attrs.inputStyle}" inputStyleClass="#{cc.parent.attrs.inputStyleClass}" labelWidth="#{cc.parent.attrs.labelWidth}"
        inputWidth="#{cc.parent.attrs.inputWidth}">

        <!--  As a list of values -->
        <c:if test="#{cc.parent.attrs.listType == 'simpleList'}">
            <p:dataTable id="#{cc.parent.attrs.fieldIdPrefix}_list"
            	resizableColumns="true" value="#{cc.attrs.fieldItem}" var="listElement" rendered="#{cc.attrs.edit}" rowIndexVar="rowIndex">
                <c:if test="#{cc.parent.attrs.showFields !=null}">
                    <c:forEach items="#{cc.parent.attrs.showFields.split(';')}" var="fieldToShow">
                        <c:set var="headerAndValue" value="#{fieldToShow.split(',')}" />
                        <c:set var="style" value="text-align:left;" />
                        <c:if test="#{'right'.equals(headerAndValue[2])}">
                            <c:set var="style" value="text-align:right;" />
                        </c:if>
                        <p:column width="100" style="${style}">
                            <f:facet name="header">
                                <h:outputText value="#{messages[headerAndValue[0]]}" />
                            </f:facet>
                            <c:set var="value" value="#{listElement[headerAndValue[1]]}"></c:set>
                            <c:if test="#{'msg'.equals(headerAndValue[2])}">
                                <c:set var="value" value="#{messages[listElement[headerAndValue[1]].label]}" />
                            </c:if>
                            <h:outputText style="text-align:right;" value="#{value}" converter="#{getConverter.forType(listElement[headerAndValue[1]])}" />
                        </p:column>
                    </c:forEach>
                    <p:column rendered="#{cc.parent.attrs.deleteButton and cc.attrs.edit}">
                        <p:tooltip for="deletelink" value="#{messages['commons.delete']}" showEffect="slide" hideEffect="slide" />
                        <h:commandLink id="deletelink" action="#{cc.parent.backingBeanFromParentOrCurrent.delete(listElement.id)}"
                            onclick="if(confirm('#{messages['commons.confirmDelete']}')){return true;}else{return false;}">
                            <h:graphicImage value="/img/delete.gif" style="border:0" />
                        </h:commandLink>
                    </p:column>
                </c:if>
                <c:if test="#{cc.parent.attrs.showFields ==null}">
                    <p:column width="90%" headerText="#{messages['commons.value']}">
                        <h:outputText style="text-align:right;" value="#{listElement}" converter="#{getConverter.forType(listElement)}" rendered="#{not cc.attrs.edit}" />
                        <p:inputText value="#{listElement}" size="50" maxlength="100" rendered="#{cc.attrs.edit}" valueChangeListener="#{cc.parent.updateItemInCollection}">
                            <f:attribute name="values" value="#{cc.attrs.fieldItem}" />
                            <f:attribute name="itemIndex" value="#{rowIndex}" />
                        </p:inputText>
                    </p:column>
                    <p:column width="10%" rendered="#{cc.parent.attrs.deleteButton and cc.attrs.edit}">
                        <p:tooltip for="deletelink" value="#{messages['commons.delete']}" showEffect="slide" hideEffect="slide" />
                        <p:commandButton id="deletelink" action="#{cc.parent.deleteItemFromCollection(cc.attrs.fieldItem, rowIndex)}"
                             partialSubmit="true" icon="ui-icon-trash"
                            process="@this" update="#{cc.parent.attrs.fieldIdPrefix}_list">
                        </p:commandButton>
                    </p:column>
                </c:if>
                <f:facet name="footer">
                    <p:commandButton value="#{messages['commons.addNew']}" partialSubmit="true" process="@this #{cc.parent.attrs.fieldIdPrefix}_list" update="#{cc.parent.attrs.fieldIdPrefix}_list"
                        actionListener="#{cc.parent.addItemToCollection(cc.attrs.fieldItem, cc.parent.attrs.fieldGenericsType)}" rendered="#{cc.parent.attrs.showFields ==null and cc.parent.attrs.showButtonAddNew and cc.attrs.edit}" />
                    <p:commandButton
                        rendered="#{cc.parent.attrs.showFields !=null and cc.parent.attrs.showButtonAddNew and cc.attrs.edit and cc.parent.entityFromBackingBeanOrAttribute.getId() != null}"
                        value="#{messages['commons.addNew']}" onclick="alert('not implemented. formListField.xhtml line 52')" />
                </f:facet>
            </p:dataTable>
            
            
            </c:if>

        <!--  As a dual picklist of values -->
        <c:if test="#{cc.parent.attrs.listType=='pickUpList'}">

            <h:panelGroup rendered="#{cc.attrs.edit}">
                <c:if test="#{empty cc.parent.attrs.dualListModel}">
                    <c:set var="elements" value="#{cc.parent.backingBeanFromParentOrCurrent.dualListModel}" />
                </c:if>
                <c:if test="#{!empty cc.parent.attrs.dualListModel}">
                    <c:set var="elements" value="#{cc.parent.attrs.dualListModel}" />
                </c:if>
                <c:if test="#{not empty(cc.parent.attrs.valueLabelField2)}">
                    <p:pickList required="#{cc.parent.attrs.required}" id="#{cc.parent.attrs.fieldIdPrefix}_list" value="#{elements}" var="elem"
                        itemLabel="#{elem[cc.parent.attrs.valueLabelField]} #{elem[cc.parent.attrs.valueLabelField2]}" itemValue="#{elem}" disabled="#{not cc.attrs.edit}">
                        <s:objectConverter />
                    </p:pickList>
                </c:if>
                <c:if test="#{empty(cc.parent.attrs.valueLabelField2)}">
                    <p:pickList required="#{cc.parent.attrs.required}" id="#{cc.parent.attrs.fieldIdPrefix}_list" value="#{elements}" var="elem"
                        itemLabel="#{elem[cc.parent.attrs.valueLabelField]}" itemValue="#{elem}" disabled="#{not cc.attrs.edit}">
                        <s:objectConverter />
                    </p:pickList>
                </c:if>

            </h:panelGroup>
        </c:if>
        <p:dataList id="#{cc.parent.attrs.fieldIdPrefix}_list_view" value="#{cc.attrs.fieldItem.toArray()}" var="elem" type="ordered" rendered="#{! cc.attrs.edit}">
            <c:if test="#{not empty(cc.parent.attrs.valueLabelField2)}">
                            #{elem[cc.parent.attrs.valueLabelField]} #{elem[cc.parent.attrs.valueLabelField2]}
                </c:if>
            <c:if test="#{empty(cc.parent.attrs.valueLabelField2)}">
                            #{elem[cc.parent.attrs.valueLabelField]}
                </c:if>
        </p:dataList>

        <cc:insertChildren />
    </hftl:decorateFormField>


    <!--         <h:panelGroup layout="block" styleClass="formFieldGroup #{cc.parent.attrs.styleClass}" style="width:#{cc.parent.attrs.componentWidth}%; #{cc.parent.attrs.style}"> -->
    <!--         <p:outputLabel for="#{cc.parent.attrs.fieldIdPrefix}_list#{cc.attrs.edit?'':'_view'}" value="#{cc.parent.attrs.label}" /> -->
    <!--         <h:panelGroup layout="block" styleClass="#{cc.parent.attrs.fieldStyle}  #{cc.parent.attrs.inputStyleClass}" -->
    <!--             style="width:#{cc.parent.attrs.inputWidth}%; #{cc.parent.attrs.inputStyle}"> -->


    <!--             <c:if test="#{cc.parent.attrs.listType == 'simpleList'}"> -->
    <!--                     <p:dataTable id="#{cc.parent.attrs.fieldIdPrefix}_list" value="#{cc.attrs.fieldItem}" var="listElement" rendered="#{cc.attrs.edit}"> -->
    <!--                         <c:forEach items="#{cc.parent.attrs.showFields.split(';')}" var="fieldToShow"> -->
    <!--                             <c:set var="headerAndValue" value="#{fieldToShow.split(',')}" /> -->
    <!--                             <c:set var="style" value="text-align:left;" /> -->
    <!--                             <c:if test="#{'right'.equals(headerAndValue[2])}"> -->
    <!--                                 <c:set var="style" value="text-align:right;" /> -->
    <!--                             </c:if> -->
    <!--                             <p:column width="100" style="${style}"> -->
    <!--                                 <f:facet name="header"> -->
    <!--                                     <h:outputText value="#{messages[headerAndValue[0]]}" /> -->
    <!--                                 </f:facet> -->
    <!--                                 <c:set var="value" value="#{listElement[headerAndValue[1]]}"></c:set> -->
    <!--                                 <c:if test="#{'msg'.equals(headerAndValue[2])}"> -->
    <!--                                     <c:set var="value" value="#{messages[listElement[headerAndValue[1]].label]}" /> -->
    <!--                                 </c:if> -->
    <!--                                 <h:outputText style="text-align:right;" value="#{value}" converter="#{getConverter.forType(listElement[headerAndValue[1]])}" /> -->
    <!--                             </p:column> -->
    <!--                         </c:forEach> -->

    <!--                         <p:column rendered="#{cc.parent.attrs.deleteButton and cc.attrs.edit}"> -->
    <!--                             <p:tooltip for="deletelink" value="#{messages['commons.delete']}" showEffect="slide" hideEffect="slide" /> -->
    <!--                             <h:commandLink id="deletelink" action="#{cc.parent.backingBeanFromParentOrCurrent.delete(listElement.id)}" -->
    <!--                                 onclick="if(confirm('#{messages['commons.confirmDelete']}')){return true;}else{return false;}"> -->
    <!--                                 <h:graphicImage value="/img/delete.gif" style="border:0" /> -->
    <!--                             </h:commandLink> -->
    <!--                         </p:column> -->
    <!--                     </p:dataTable> -->
    <!--                     <p:commandButton rendered="#{cc.parent.attrs.showButtonAddNew and cc.attrs.edit and cc.parent.entityFromBackingBeanOrAttribute.getId() != null}" -->
    <!--                         value="#{messages['commons.addNew']}" onclick="alert('not implemented. formListField.xhtml line 52')" /> -->
    <!--             </c:if> -->

    <!--             <c:if test="#{cc.parent.attrs.listType=='pickUpList'}"> -->

    <!--                 <h:panelGroup rendered="#{cc.attrs.edit}"> -->
    <!--                     <c:if test="#{empty cc.parent.attrs.dualListModel}"> -->
    <!--                         <c:set var="elements" value="#{cc.parent.backingBeanFromParentOrCurrent.dualListModel}" /> -->
    <!--                     </c:if> -->
    <!--                     <c:if test="#{!empty cc.parent.attrs.dualListModel}"> -->
    <!--                         <c:set var="elements" value="#{cc.parent.attrs.dualListModel}" /> -->
    <!--                     </c:if> -->
    <!--                     <c:if test="#{not empty(cc.parent.attrs.valueLabelField2)}"> -->
    <!--                         <p:pickList required="#{cc.parent.attrs.required}" id="#{cc.parent.attrs.fieldIdPrefix}_list" value="#{elements}" var="elem" -->
    <!--                             itemLabel="#{elem[cc.parent.attrs.valueLabelField]} #{elem[cc.parent.attrs.valueLabelField2]}" itemValue="#{elem}" disabled="#{not cc.attrs.edit}"> -->
    <!--                             <s:objectConverter /> -->
    <!--                         </p:pickList> -->
    <!--                     </c:if> -->
    <!--                     <c:if test="#{empty(cc.parent.attrs.valueLabelField2)}"> -->
    <!--                         <p:pickList required="#{cc.parent.attrs.required}" id="#{cc.parent.attrs.fieldIdPrefix}_list" value="#{elements}" var="elem" -->
    <!--                             itemLabel="#{elem[cc.parent.attrs.valueLabelField]}" itemValue="#{elem}" disabled="#{not cc.attrs.edit}"> -->
    <!--                             <s:objectConverter /> -->
    <!--                         </p:pickList> -->
    <!--                     </c:if> -->

    <!--                 </h:panelGroup> -->
    <!--             </c:if> -->
    <!--             <p:dataList id="#{cc.parent.attrs.fieldIdPrefix}_list_view" value="#{cc.attrs.fieldItem.toArray()}" var="elem" type="ordered" rendered="#{! cc.attrs.edit}"> -->
    <!--                 <c:if test="#{not empty(cc.parent.attrs.valueLabelField2)}"> -->
    <!--                             #{elem[cc.parent.attrs.valueLabelField]} #{elem[cc.parent.attrs.valueLabelField2]} -->
    <!--                 </c:if> -->
    <!--                 <c:if test="#{empty(cc.parent.attrs.valueLabelField2)}"> -->
    <!--                             #{elem[cc.parent.attrs.valueLabelField]} -->
    <!--                 </c:if> -->
    <!--             </p:dataList> -->

    <!--             <cc:insertChildren /> -->
    <!--         </h:panelGroup> -->
    <!--     </h:panelGroup> -->

</cc:implementation>

</html>
