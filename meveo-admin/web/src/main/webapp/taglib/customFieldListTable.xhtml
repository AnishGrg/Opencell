<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:p="http://primefaces.org/ui"
	xmlns:c="http://java.sun.com/jsp/jstl/core"
	xmlns:cc="http://java.sun.com/jsf/composite"
	xmlns:o="http://omnifaces.org/ui" xmlns:hftl="http://hftl.org">

<ui:composition>
	<h:outputText value="#{''}" />
	<c:if test="${empty(datePattern)}">
		<c:set var="datePattern"
			value="#{paramBean.getProperty('meveo.dateFormat','dd/MM/yyyy')}" />
	</c:if>
	<o:importConstants
		type="org.meveo.model.crm.CustomFieldStorageTypeEnum" />
	<o:importConstants type="org.meveo.model.crm.CustomFieldTypeEnum" />
	<hftl:decorateFormField
		label="#{cft.description}#{cft.valueRequired?' *':''}"
		componentWidth="100" displayOneLine="true">
		<!-- entity list -->
		<p:dataTable id="customFields_entitylist" lazy="false"
			rendered="#{cft.storageType== CustomFieldStorageTypeEnum.LIST and cft.fieldType==CustomFieldTypeEnum.ENTITY}"
			value="#{cft.instance.entityList}" var="w" reflow="true" resizableColumns="true">
			<p:column headerText="#{messages['businessEntity.code']}" sortBy="#{w.businessEntity.code}">
				<h:outputText value="#{w.businessEntity.code}"/>
            </p:column>
			<p:column headerText="#{messages['commons.actions']}" width="15%">
				<p:commandButton id="editlink" onsuccess="PF('#{cfiDialogWidget}').show()"
					partialSubmit="true" icon="ui-icon-pencil" update="@this @([id$='dlg_cft_cfi_newform'])" process="@this">
					<f:setPropertyActionListener value="#{w}" target="#{backingBean.baseWrapper}"/>
					<f:setPropertyActionListener value="#{cft}" target="#{backingBean.customFieldSelectedTemplate}"/>
				</p:commandButton>
				<p:commandButton id="deletelink"
					actionListener="#{cft.instance.removeEntityFromlist(w)}"
					partialSubmit="true" icon="ui-icon-trash" ajax="true"
					update="customFields_entitylist"
					process="@this">
				</p:commandButton>
			</p:column>
			<f:facet name="footer">
				<p:commandButton value="#{messages['commons.addNew']}" process="@this"
					immediate="true" update="@this @([id$='dlg_cft_cfi_newform'])" partialSubmit="true"
					actionListener="#{cft.instance.setValue(cft.getDefaultValueConverted(), cft.fieldType,cft.storageType)}"
					onsuccess="PF('#{cfiDialogWidget}').show()">
					<f:setPropertyActionListener target="#{backingBean.customFieldSelectedTemplate}" value="#{cft}" />
				</p:commandButton>
			</f:facet>
		</p:dataTable>
		<!-- string list or select or textarea-->
		<p:dataTable id="customFields_stringlist" lazy="false"
			rendered="#{cft.storageType eq CustomFieldStorageTypeEnum.LIST and (cft.fieldType eq CustomFieldTypeEnum.STRING or
			cft.fieldType eq CustomFieldTypeEnum.LIST or cft.fieldType eq CustomFieldTypeEnum.TEXT_AREA)}"
			value="#{cft.instance.stringList}" var="w" reflow="true" resizableColumns="true">
			<p:column headerText="#{messages['commons.value']}" sortBy="#{w.stringValue}">
				<h:outputText value="#{w.truncateValue}"/>
			</p:column>
			<p:column headerText="#{messages['commons.actions']}" width="15%">
				<p:commandButton id="editlink" onsuccess="PF('#{cfiDialogWidget}').show()"
					partialSubmit="true" icon="ui-icon-pencil" update="@this @([id$='dlg_cft_cfi_newform'])"
					process="@this customFields_stringlist">
					<f:setPropertyActionListener value="#{w}" target="#{backingBean.baseWrapper}"/>
					<f:setPropertyActionListener value="#{cft}" target="#{backingBean.customFieldSelectedTemplate}"/>
				</p:commandButton>
				<p:commandButton id="deletelink"
					actionListener="#{cft.instance.removeStringFromlist(w)}"
					partialSubmit="true" icon="ui-icon-trash"
					update="customFields_stringlist" process="@this">
				</p:commandButton>
			</p:column>
			<f:facet name="footer">
				<p:commandButton value="#{messages['commons.addNew']}" partialSubmit="true" 
					immediate="true" update="@this @([id$='dlg_cft_cfi_newform'])" process="@this"
					actionListener="#{cft.instance.setValue(cft.getDefaultValueConverted(), cft.fieldType,cft.storageType)}"
					onsuccess="PF('#{cfiDialogWidget}').show()">
					<f:setPropertyActionListener value="#{null}" target="#{backingBean.baseWrapper}"/>
					<f:setPropertyActionListener value="#{cft}" target="#{backingBean.customFieldSelectedTemplate}"/>
				</p:commandButton>
			</f:facet>
		</p:dataTable>
		<!-- date list -->
		<p:dataTable id="customFields_datelist" lazy="false"
			rendered="#{cft.storageType== CustomFieldStorageTypeEnum.LIST and cft.fieldType==CustomFieldTypeEnum.DATE}"
			value="#{cft.instance.dateList}" var="w" resizableColumns="true" reflow="true">
			<p:column headerText="#{messages['commons.value']}" sortBy="#{w.dateValue}">
				<h:outputText value="#{w.dateValue}" >
					<f:convertDateTime type="date" pattern="#{datePattern}" />
				</h:outputText>
			</p:column>
			<p:column headerText="#{messages['commons.actions']}" width="15%">
				<p:commandButton id="editlink" onsuccess="PF('#{cfiDialogWidget}').show()"
					partialSubmit="true" icon="ui-icon-pencil" update="@this @([id$='dlg_cft_cfi_newform'])">
					<f:setPropertyActionListener value="#{w}" target="#{backingBean.baseWrapper}"/>
					<f:setPropertyActionListener value="#{cft}" target="#{backingBean.customFieldSelectedTemplate}"/>
				</p:commandButton>
				<p:commandButton id="deletelink"
					actionListener="#{cft.instance.removeDateFromlist(w)}" partialSubmit="true"
					icon="ui-icon-trash" update="customFields_datelist"
					process="@this">
				</p:commandButton>
			</p:column>
			<f:facet name="footer">
				<p:commandButton value="#{messages['commons.addNew']}" partialSubmit="true"
					immediate="true" update="@this @([id$='dlg_cft_cfi_newform'])"
					actionListener="#{cft.instance.setValue(cft.getDefaultValueConverted(), cft.fieldType,cft.storageType)}"
					onsuccess="PF('#{cfiDialogWidget}').show()">
					<f:setPropertyActionListener value="#{null}" target="#{backingBean.baseWrapper}"/>
					<f:setPropertyActionListener value="#{cft}" target="#{backingBean.customFieldSelectedTemplate}"/>
				</p:commandButton>
			</f:facet>
		</p:dataTable>
		<!-- long list -->
		<p:dataTable id="customFields_longlist" lazy="false"
			rendered="#{cft.storageType==CustomFieldStorageTypeEnum.LIST and cft.fieldType==CustomFieldTypeEnum.LONG}"
			value="#{cft.instance.longList}" var="w" resizableColumns="true" reflow="true">
			<p:column headerText="#{messages['commons.value']}" sortBy="#{w.longValue}">
				<h:outputText value="#{w.longValue}"/>
			</p:column>
			<p:column headerText="#{messages['commons.actions']}" width="15%">
				<p:commandButton id="editlink" onsuccess="PF('#{cfiDialogWidget}').show()"
					partialSubmit="true" icon="ui-icon-pencil" update="@this @([id$='dlg_cft_cfi_newform'])" process="@this">
					<f:setPropertyActionListener value="#{w}" target="#{backingBean.baseWrapper}"/>
					<f:setPropertyActionListener value="#{cft}" target="#{backingBean.customFieldSelectedTemplate}"/>
				</p:commandButton>
				<p:commandButton id="deletelink"
					action="#{cft.instance.removeLongFromlist(w)}" partialSubmit="true"
					icon="ui-icon-trash" update="customFields_longlist"
					process="@this">
				</p:commandButton>
			</p:column>
			<f:facet name="footer">
				<p:commandButton value="#{messages['commons.addNew']}" partialSubmit="true"
					immediate="true" update="@this @([id$='dlg_cft_cfi_newform'])" process="@this"
					action="#{cft.instance.setValue(cft.getDefaultValueConverted(), cft.fieldType,cft.storageType)}"
					onsuccess="PF('#{cfiDialogWidget}').show()">
					<f:setPropertyActionListener value="#{null}" target="#{backingBean.baseWrapper}"/>
					<f:setPropertyActionListener value="#{cft}" target="#{backingBean.customFieldSelectedTemplate}"/>
				</p:commandButton>
			</f:facet>
		</p:dataTable>
		<!-- double list -->
		<p:dataTable id="customFields_doublelist" lazy="false"
			rendered="#{cft.storageType== CustomFieldStorageTypeEnum.LIST and cft.fieldType==CustomFieldTypeEnum.DOUBLE}"
			value="#{cft.instance.doubleList}" var="w" resizableColumns="true" reflow="true">
			<p:column headerText="#{messages['commons.value']}" sortBy="#{w.doubleValue}">
				<h:outputText value="#{w.doubleValue}" />
			</p:column>
			<p:column headerText="#{messages['commons.actions']}" width="15%">
				<p:commandButton id="editlink" onsuccess="PF('#{cfiDialogWidget}').show()"
					partialSubmit="true" icon="ui-icon-pencil" update="@this @([id$='dlg_cft_cfi_newform'])" process="@this">
					<f:setPropertyActionListener value="#{w}" target="#{backingBean.baseWrapper}"/>
					<f:setPropertyActionListener value="#{cft}" target="#{backingBean.customFieldSelectedTemplate}"/>
				</p:commandButton>
				<p:commandButton id="deletelink"
					action="#{cft.instance.removeDoubleFromlist(w)}"
					partialSubmit="true" icon="ui-icon-trash"
					update="customFields_doublelist"
					process="@this">
				</p:commandButton>
			</p:column>
			<f:facet name="footer">
				<p:commandButton value="#{messages['commons.addNew']}" process="@this" partialSubmit="true"
					immediate="true" update="@this @([id$='dlg_cft_cfi_newform'])"
					actionListener="#{cft.instance.setValue(cft.getDefaultValueConverted(), cft.fieldType,cft.storageType)}"
					onsuccess="PF('#{cfiDialogWidget}').show()">
					<f:setPropertyActionListener value="#{null}" target="#{backingBean.baseWrapper}"/>
					<f:setPropertyActionListener value="#{cft}" target="#{backingBean.customFieldSelectedTemplate}"/>
				</p:commandButton>
			</f:facet>
		</p:dataTable>
		<!--map  -->
		<!-- entity map -->
		<p:dataTable id="customFields_entitymap" lazy="false"
			rendered="#{cft.storageType== CustomFieldStorageTypeEnum.MAP and cft.fieldType==CustomFieldTypeEnum.ENTITY}"
			value="#{cft.instance.entityMap.entrySet}" var="m" resizableColumns="true" reflow="true">
			<p:column headerText="#{messages['commons.label']}" sortBy="#{m.key}">
				<h:outputText value="#{m.key}" />
			</p:column>
			<p:column headerText="#{messages['commons.value']}">
				<ui:repeat var="v" value="#{m.value}">
					<h:outputText value="#{v.businessEntity.code}" /><br/>
				</ui:repeat>
			</p:column>
			<p:column headerText="#{messages['commons.actions']}" width="15%">
				<p:commandButton id="editlink" onsuccess="PF('#{cfiDialogWidget}').show()"
					actionListener="#{cft.instance.editInmap(m.key,cft)}"
					partialSubmit="true" icon="ui-icon-pencil" update="@this @([id$='dlg_cft_cfi_newform'])" process="@this">
					<f:setPropertyActionListener value="#{null}" target="#{backingBean.baseWrapper}"/>
					<f:setPropertyActionListener value="#{cft}" target="#{backingBean.customFieldSelectedTemplate}"/>
				</p:commandButton>
				<p:commandButton id="deletelink"
					actionListener="#{cft.instance.removeFrommap(m.key,cft.fieldType)}"
					partialSubmit="true" icon="ui-icon-trash"
					update="@this customFields_entitymap"
					process="@this">
				</p:commandButton>
			</p:column>
			<f:facet name="footer">
				<p:commandButton value="#{messages['commons.addNew']}" partialSubmit="true" process="@this"
					immediate="true" update="@this @([id$='dlg_cft_cfi_newform'])"
					actionListener="#{cft.instance.setValue(cft.getDefaultValueConverted(), cft.fieldType,cft.storageType)}"
					onsuccess="PF('#{cfiDialogWidget}').show()">
					<f:setPropertyActionListener value="#{null}" target="#{backingBean.baseWrapper}"/>
					<f:setPropertyActionListener value="#{cft}" target="#{backingBean.customFieldSelectedTemplate}"/>
				</p:commandButton>
			</f:facet>
		</p:dataTable>
		<!-- string or selectlist or textarea map -->
		<p:dataTable id="customFields_stringmap" lazy="false"
			rendered="#{cft.storageType eq CustomFieldStorageTypeEnum.MAP and 
			(cft.fieldType eq CustomFieldTypeEnum.STRING or cft.fieldType eq CustomFieldTypeEnum.LIST or cft.fieldType eq CustomFieldTypeEnum.TEXT_AREA)}"
			value="#{cft.instance.stringMap.entrySet}" var="m" resizableColumns="true" reflow="true">
			<p:column headerText="#{messages['commons.label']}" sortBy="#{m.key}">
				<h:outputText value="#{m.key}" />
			</p:column>
			<p:column headerText="#{messages['commons.value']}">
				<ui:repeat var="v" value="#{m.value}">
					<h:outputText value="#{v.stringValue}" /><br/>
				</ui:repeat>
			</p:column>
			<p:column headerText="#{messages['commons.actions']}" width="15%">
				<p:commandButton id="editlink" onsuccess="PF('#{cfiDialogWidget}').show()"
					actionListener="#{cft.instance.editInmap(m.key,cft)}"
					partialSubmit="true" icon="ui-icon-pencil" update="@this @([id$='dlg_cft_cfi_newform'])">
					<f:setPropertyActionListener value="#{null}" target="#{backingBean.baseWrapper}"/>
					<f:setPropertyActionListener value="#{cft}" target="#{backingBean.customFieldSelectedTemplate}"/>
				</p:commandButton>
				<p:commandButton id="deletelink"
					action="#{cft.instance.removeFrommap(m.key,cft.fieldType)}"
					partialSubmit="true" icon="ui-icon-trash"
					update="customFields_stringmap"
					process="@this">
				</p:commandButton>
			</p:column>
			<f:facet name="footer">
				<p:commandButton value="#{messages['commons.addNew']}" process="@this" partialSubmit="true"
					immediate="true" update="@this @([id$='dlg_cft_cfi_newform']}"
					onsuccess="PF('#{cfiDialogWidget}').show()"
					actionListener="#{cft.instance.setValue(cft.getDefaultValueConverted(), cft.fieldType,cft.storageType)}">
					<f:setPropertyActionListener value="#{null}" target="#{backingBean.baseWrapper}"/>
					<f:setPropertyActionListener value="#{cft}" target="#{backingBean.customFieldSelectedTemplate}"/>
				</p:commandButton>
			</f:facet>
		</p:dataTable>
		<!-- date map -->
		<p:dataTable id="customFields_datemap" lazy="false"
			rendered="#{cft.storageType== CustomFieldStorageTypeEnum.MAP and cft.fieldType==CustomFieldTypeEnum.DATE}"
			value="#{cft.instance.dateMap.entrySet}" var="m" resizableColumns="true" reflow="true">
			<p:column headerText="#{messages['commons.label']}" sortBy="#{m.key}">
				<h:outputText value="#{m.key}" />
			</p:column>
			<p:column headerText="#{messages['commons.value']}">
				<ui:repeat var="v" value="#{m.value}">
					<h:outputText value="#{v.dateValue}" >
						<f:convertDateTime type="date" pattern="#{datePattern}" />
					</h:outputText><br/>
				</ui:repeat>
			</p:column>
			<p:column headerText="#{messages['commons.actions']}" width="15%">
				<p:commandButton id="editlink" onsuccess="PF('#{cfiDialogWidget}').show()"
					actionListener="#{cft.instance.editInmap(m.key,cft)}" process="@this"
					partialSubmit="true" icon="ui-icon-pencil" update="@this @([id$='dlg_cft_cfi_newform'])">
					<f:setPropertyActionListener value="#{null}" target="#{backingBean.baseWrapper}"/>
					<f:setPropertyActionListener value="#{cft}" target="#{backingBean.customFieldSelectedTemplate}"/>
				</p:commandButton>
				<p:commandButton id="deletelink"
					action="#{cft.instance.removeFrommap(m.key,cft.fieldType)}" partialSubmit="true"
					icon="ui-icon-trash" update="customFields_datemap"
					process="@this">
				</p:commandButton>
			</p:column>
			<f:facet name="footer">
				<p:commandButton value="#{messages['commons.addNew']}" process="@this" partialSubmit="true"
					immediate="true" update="@this @([id$='dlg_cft_cfi_newform'])"
					actionListener="#{cft.instance.setValue(cft.getDefaultValueConverted(), cft.fieldType,cft.storageType)}"
					onsuccess="PF('#{cfiDialogWidget}').show()">
					<f:setPropertyActionListener value="#{null}" target="#{backingBean.baseWrapper}"/>
					<f:setPropertyActionListener value="#{cft}" target="#{backingBean.customFieldSelectedTemplate}"/>
				</p:commandButton>
			</f:facet>
		</p:dataTable>
		<!-- long map -->
		<p:dataTable id="customFields_longmap" lazy="false"
			rendered="#{cft.storageType== CustomFieldStorageTypeEnum.MAP and cft.fieldType==CustomFieldTypeEnum.LONG}"
			value="#{cft.instance.longMap.entrySet}" var="m" resizableColumns="true" reflow="true">
			<p:column headerText="#{messages['commons.label']}" sortBy="#{m.key}">
				<h:outputText value="#{m.key}" />
			</p:column>
			<p:column headerText="#{messages['commons.value']}">
				<ui:repeat var="v" value="#{m.value}">
					<h:outputText value="#{v.longValue}"/><br/>
				</ui:repeat>
			</p:column>
			<p:column headerText="#{messages['commons.actions']}" width="15%">
				<p:commandButton id="editlink" onsuccess="PF('#{cfiDialogWidget}').show()"
					actionListener="#{cft.instance.editInmap(m.key,cft)}"
					partialSubmit="true" icon="ui-icon-pencil" update="@this @([id$='dlg_cft_cfi_newform'])">
					<f:setPropertyActionListener value="#{null}" target="#{backingBean.baseWrapper}"/>
					<f:setPropertyActionListener value="#{cft}" target="#{backingBean.customFieldSelectedTemplate}"/>
				</p:commandButton>
				<p:commandButton id="deletelink"
					actionListener="#{cft.instance.removeFrommap(m.key,cft.fieldType)}" partialSubmit="true"
					icon="ui-icon-trash" update="customFields_longmap"
					process="@this customFields_longmap">
				</p:commandButton>
			</p:column>
			<f:facet name="footer">
				<p:commandButton value="#{messages['commons.addNew']}" process="@this" partialSubmit="true"
					immediate="true" update="@this @([id$='dlg_cft_cfi_newform'])"
					actionListener="#{cft.instance.setValue(cft.getDefaultValueConverted(), cft.fieldType,cft.storageType)}"
					onsuccess="PF('#{cfiDialogWidget}').show()">
					<f:setPropertyActionListener value="#{null}" target="#{backingBean.baseWrapper}"/>
					<f:setPropertyActionListener value="#{cft}" target="#{backingBean.customFieldSelectedTemplate}"/>
				</p:commandButton>
			</f:facet>
		</p:dataTable>
		<!-- double map -->
		<p:dataTable id="customFields_doublemap" lazy="false"
			rendered="#{cft.storageType eq 'MAP' and cft.fieldType eq CustomFieldTypeEnum.DOUBLE}"
			value="#{cft.instance.doubleMap.entrySet}" var="m" resizableColumns="true" reflow="true">
			<p:column headerText="#{messages['commons.label']}" sortBy="#{m.key}">
				<h:outputText value="#{m.key}" />
			</p:column>
			<p:column headerText="#{messages['commons.value']}" sortBy="#{m.value}">
				<ui:repeat var="v" value="#{m.value}">
					<h:outputText value="#{v.doubleValue}"/><br/>
				</ui:repeat>
			</p:column>
			<p:column headerText="#{messages['commons.actions']}" width="15%">
				<p:commandButton id="editlink" onsuccess="PF('#{cfiDialogWidget}').show()"
					actionListener="#{cft.instance.editInmap(m.key,cft)}"
					partialSubmit="true" icon="ui-icon-pencil" update="@this @([id$='dlg_cft_cfi_newform'])">
					<f:setPropertyActionListener value="#{null}" target="#{backingBean.baseWrapper}"/>
					<f:setPropertyActionListener value="#{cft}" target="#{backingBean.customFieldSelectedTemplate}"/>
				</p:commandButton>
				<p:commandButton id="deletelink"
					actionListener="#{cft.instance.removeFrommap(m.key,cft.fieldType)}"
					partialSubmit="true" icon="ui-icon-trash"
					update="customFields_doublemap"
					process="@this customFields_doublemap">
				</p:commandButton>
			</p:column>
			<f:facet name="footer">
				<p:commandButton value="#{messages['commons.addNew']}" process="@this" partialSubmit="true"
					immediate="true" update="@this @([id$='dlg_cft_cfi_newform'])"
					actionListener="#{cft.instance.setValue(cft.getDefaultValueConverted(), cft.fieldType,cft.storageType)}"
					onsuccess="PF('#{cfiDialogWidget}').show()">
					<f:setPropertyActionListener value="#{null}" target="#{backingBean.baseWrapper}"/>
					<f:setPropertyActionListener value="#{cft}" target="#{backingBean.customFieldSelectedTemplate}"/>
				</p:commandButton>
			</f:facet>
		</p:dataTable>
	</hftl:decorateFormField>
</ui:composition>
</html>
